/*! UIkit 2.13.1 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */
!function(t){var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-htmleditor",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";var i=[];return e.component("htmleditor",{defaults:{iframe:!1,mode:"split",markdown:!1,autocomplete:!0,height:500,maxsplitsize:1e3,markedOptions:{gfm:!0,tables:!0,breaks:!0,pedantic:!0,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"},codemirror:{mode:"htmlmixed",lineWrapping:!0,dragDrop:!1,autoCloseTags:!0,matchTags:!0,autoCloseBrackets:!0,matchBrackets:!0,indentUnit:4,indentWithTabs:!1,tabSize:4,hintOptions:{completionSingle:!1}},toolbar:["h2","h3","h4","h5","h6","bold","italic","listUl","listOl","back","nbsp","hr","blockquote","link"],lblPreview:"Preview",lblCodeview:"HTML",lblMarkedview:"Markdown",labels:{h2:"Headline 2",h3:"Headline 3",h4:"Headline 4",h5:"Headline 5",h6:"Headline 6",fullscreen:"Fullscreen",bold:"Bold",italic:"Italic",strike:"Strikethrough",blockquote:"Blockquote",link:"Link",image:"Image",listUl:"Unordered List",listOl:"Ordered List",back:"Back",hr:"Separator",nbsp:"Non-breaking space"},icons:{h2:'<i class="@-icon-rz-h2"></i>',h3:'<i class="@-icon-rz-h3"></i>',h4:'<i class="@-icon-rz-h4"></i>',h5:'<i class="@-icon-rz-h5"></i>',h6:'<i class="@-icon-rz-h6"></i>',fullscreen:'<i class="@-icon-rz-fullscreen"></i>',bold:'<i class="@-icon-rz-bold"></i>',italic:'<i class="@-icon-rz-italic"></i>',strike:'<i class="@-icon-rz-strikethrough"></i>',blockquote:'<i class="@-icon-rz-quote"></i>',link:'<i class="@-icon-rz-link"></i>',image:'<i class="@-icon-rz-documents"></i>',listUl:'<i class="@-icon-rz-unordered-list"></i>',listOl:'<i class="@-icon-rz-ordered-list"></i>',back:'<i class="@-icon-rz-back"></i>',hr:'<i class="@-icon-rz-hr"></i>',nbsp:'<i class="@-icon-rz-space-forced"></i>'}},boot:function(){e.ready(function(t){e.$("textarea[data-@-htmleditor]",t).each(function(){var t,i=e.$(this);i.data("htmleditor")||(t=e.htmleditor(i,e.Utils.options(i.attr("data-@-htmleditor"))))})})},init:function(){var o=this,n=e.components.htmleditor.template;this.CodeMirror=this.options.CodeMirror||CodeMirror,this.buttons={},n=n.replace(/\{:lblPreview\}/g,this.options.lblPreview),n=n.replace(/\{:lblCodeview\}/g,this.options.lblCodeview),this.htmleditor=e.$(n),this.content=this.htmleditor.find(".@-htmleditor-content"),this.toolbar=this.htmleditor.find(".@-htmleditor-toolbar"),this.preview=this.htmleditor.find(".@-htmleditor-preview").children().eq(0),this.code=this.htmleditor.find(".@-htmleditor-code"),this.element.before(this.htmleditor).appendTo(this.code),this.editor=this.CodeMirror.fromTextArea(this.element[0],this.options.codemirror),this.editor.htmleditor=this,this.editor.on("change",e.Utils.debounce(function(){o.render()},150)),this.editor.on("change",function(){o.editor.save()}),this.code.find(".CodeMirror").css("height",this.options.height),this.options.iframe?(this.iframe=e.$('<iframe class="@-htmleditor-iframe" frameborder="0" scrolling="auto" height="100" width="100%"></iframe>'),this.preview.append(this.iframe),this.iframe[0].contentWindow.document.open(),this.iframe[0].contentWindow.document.close(),this.preview.container=t(this.iframe[0].contentWindow.document).find("body"),"string"==typeof this.options.iframe&&this.preview.container.parent().append('<link rel="stylesheet" href="'+this.options.iframe+'">')):this.preview.container=this.preview,e.$win.on("resize",e.Utils.debounce(function(){o.fit()},200));var l=this.iframe?this.preview.container:o.preview.parent(),r=this.code.find(".CodeMirror-sizer"),s=this.code.find(".CodeMirror-scroll").on("scroll",e.Utils.debounce(function(){if("tab"!=o.htmleditor.attr("data-mode")){var t=r.height()-s.height(),e=l[0].scrollHeight-(o.iframe?o.iframe.height():l.height()),i=e/t,n=s.scrollTop()*i;l.scrollTop(n)}},10));this.htmleditor.on("click",".@-htmleditor-button-code, .@-htmleditor-button-preview",function(t){t.preventDefault(),"tab"==o.htmleditor.attr("data-mode")&&(o.htmleditor.find(".@-htmleditor-button-code, .@-htmleditor-button-preview").removeClass("@-active").filter(this).addClass("@-active"),o.activetab=e.$(this).hasClass("@-htmleditor-button-code")?"code":"preview",o.htmleditor.attr("data-active-tab",o.activetab),o.editor.refresh())}),this.htmleditor.on("click","a[data-htmleditor-button]",function(){o.code.is(":visible")&&o.trigger("action."+e.$(this).data("htmleditor-button"),[o.editor])}),this.preview.parent().css("height",this.code.height()),this.options.autocomplete&&this.CodeMirror.showHint&&this.CodeMirror.hint&&this.CodeMirror.hint.html&&this.editor.on("inputRead",e.Utils.debounce(function(){var t=o.editor.getDoc(),e=t.getCursor(),i=o.CodeMirror.innerMode(o.editor.getMode(),o.editor.getTokenAt(e).state).mode.name;if("xml"==i){var n=o.editor.getCursor(),l=o.editor.getTokenAt(n);("<"==l.string.charAt(0)||"attribute"==l.type)&&o.CodeMirror.showHint(o.editor,o.CodeMirror.hint.html,{completeSingle:!1})}},100)),this.debouncedRedraw=e.Utils.debounce(function(){o.redraw()},5),this.on("init.uk.component",function(){o.redraw()}),this.element.attr("data-@-check-display",1).on("display.uk.check",function(){this.htmleditor.is(":visible")&&this.fit()}.bind(this)),i.push(this)},addButton:function(t,e){this.buttons[t]=e},addButtons:function(e){t.extend(this.buttons,e)},replaceInPreview:function(t,e){function i(t){var e=o.getValue().substring(0,t).split("\n");return{line:e.length-1,ch:e[e.length-1].length}}var o=this.editor,n=[],l=o.getValue(),r=-1;return this.currentvalue=this.currentvalue.replace(t,function(){r=l.indexOf(arguments[0],++r);var t={matches:arguments,from:i(r),to:i(r+arguments[0].length),replace:function(e){o.replaceRange(e,t.from,t.to)},inRange:function(e){return e.line===t.from.line&&e.line===t.to.line?e.ch>=t.from.ch&&e.ch<t.to.ch:e.line===t.from.line&&e.ch>=t.from.ch||e.line>t.from.line&&e.line<t.to.line||e.line===t.to.line&&e.ch<t.to.ch}},s=e(t);return s?(n.push(t),s):arguments[0]}),n},_buildtoolbar:function(){if(this.options.toolbar&&this.options.toolbar.length){var t=this,i=[];this.toolbar.empty(),this.options.toolbar.forEach(function(e){if(t.buttons[e]){var o=t.buttons[e].title?t.buttons[e].title:e;i.push('<li class="@-htmleditor-button-cont-'+e+'"><a class="@-htmleditor-button-'+e+'" data-htmleditor-button="'+e+'" title="'+o+'" data-@-tooltip="{animation:true}">'+t.buttons[e].label+"</a></li>")}}),this.toolbar.html(e.prefix(i.join("\n")))}},fit:function(){var t=this.options.mode;"split"==t&&this.htmleditor.width()<this.options.maxsplitsize&&(t="tab"),"tab"==t&&(this.activetab||(this.activetab="code",this.htmleditor.attr("data-active-tab",this.activetab)),this.htmleditor.find(".@-htmleditor-button-code, .@-htmleditor-button-preview").removeClass("@-active").filter("code"==this.activetab?".@-htmleditor-button-code":".@-htmleditor-button-preview").addClass("@-active")),this.editor.refresh(),this.preview.parent().css("height",this.code.height()),this.htmleditor.attr("data-mode",t)},redraw:function(){this._buildtoolbar(),this.render(),this.fit()},getMode:function(){return this.editor.getOption("mode")},getCursorMode:function(){var t={mode:"html"};return this.trigger("cursorMode",[t]),t.mode},render:function(){return this.currentvalue=this.editor.getValue(),this.currentvalue?(this.trigger("render",[this]),this.trigger("renderLate",[this]),this.preview.container.html(this.currentvalue),void 0):(this.element.val(""),this.preview.container.html(""),void 0)},addShortcut:function(e,i){var o={};return t.isArray(e)||(e=[e]),e.forEach(function(t){o[t]=i}),this.editor.addKeyMap(o),o},addShortcutAction:function(t,e){var i=this;this.addShortcut(e,function(){i.element.trigger("action."+t,[i.editor])})},replaceSelection:function(t){var e=this.editor.getSelection();if(!e.length){for(var i=this.editor.getCursor(),o=this.editor.getLine(i.line),n=i.ch,l=n;l<o.length&&/[\w$]+/.test(o.charAt(l));)++l;for(;n&&/[\w$]+/.test(o.charAt(n-1));)--n;var r=n!=l&&o.slice(n,l);r&&(this.editor.setSelection({line:i.line,ch:n},{line:i.line,ch:l}),e=r)}var s=t.replace("$1",e);this.editor.replaceSelection(s,"end"),this.editor.focus()},replaceLine:function(t){var e=this.editor.getDoc().getCursor(),i=this.editor.getLine(e.line),o=t.replace("$1",i);this.editor.replaceRange(o,{line:e.line,ch:0},{line:e.line,ch:i.length}),this.editor.setCursor({line:e.line,ch:o.length}),this.editor.focus()},save:function(){this.editor.save()}}),e.components.htmleditor.template=['<div class="@-htmleditor @-clearfix" data-mode="split">','<div class="@-htmleditor-navbar">','<ul class="@-htmleditor-navbar-nav @-htmleditor-toolbar"></ul>','<div class="@-htmleditor-navbar-flip">','<ul class="@-htmleditor-navbar-nav">','<li class="@-htmleditor-button-code"><a class="@-htmleditor-button-link-code-preview @-htmleditor-button-link-code" title="Markdown" data-@-tooltip="{animation:true}">{:lblCodeview}</a></li>','<li class="@-htmleditor-button-preview"><a class="@-htmleditor-button-link-code-preview @-htmleditor-button-link-preview" title="Preview" data-@-tooltip="{animation:true}"><i class="@-icon-rz-visibility-mini"></i></a></li>','<li class="@-htmleditor-button-fullscreen"><a class="@-htmleditor-button-link-fullscreen" data-htmleditor-button="fullscreen" title="Fullscreen"  data-@-tooltip="{animation:true}"><i class="@-icon-rz-fullscreen"></i></a></li>',"</ul>",'<div class="uk-htmleditor-count">','<span class="count-current"></span> / <span class="count-limit"></span>',"</div>","</div>","</div>",'<div class="@-htmleditor-content">','<div class="@-htmleditor-code"></div>','<div class="@-htmleditor-preview"><div></div></div>',"</div>","</div>"].join(""),e.plugin("htmleditor","base",{init:function(t){function i(e,i,o){t.on("action."+e,function(){"html"==t.getCursorMode()&&t["replaceLine"==o?"replaceLine":"replaceSelection"](i)})}t.addButtons({h2:{title:t.options.labels.h2,label:t.options.icons.h2},h3:{title:t.options.labels.h3,label:t.options.icons.h3},h4:{title:t.options.labels.h4,label:t.options.icons.h4},h5:{title:t.options.labels.h5,label:t.options.icons.h5},h6:{title:t.options.labels.h6,label:t.options.icons.h6},fullscreen:{title:t.options.labels.fullscreen,label:t.options.icons.fullscreen},bold:{title:t.options.labels.bold,label:t.options.icons.bold},italic:{title:t.options.labels.italic,label:t.options.icons.italic},strike:{title:t.options.labels.strike,label:t.options.icons.strike},blockquote:{title:t.options.labels.blockquote,label:t.options.icons.blockquote},link:{title:t.options.labels.link,label:t.options.icons.link},image:{title:t.options.labels.image,label:t.options.icons.image},listUl:{title:t.options.labels.listUl,label:t.options.icons.listUl},listOl:{title:t.options.labels.listOl,label:t.options.icons.listOl},back:{title:t.options.labels.back,label:t.options.icons.back},hr:{title:t.options.labels.hr,label:t.options.icons.hr},nbsp:{title:t.options.labels.nbsp,label:t.options.icons.nbsp}}),i("h2","<h2>$1</h2>"),i("h3","<h3>$1</h3>"),i("h4","<h4>$1</h4>"),i("h5","<h5>$1</h5>"),i("h6","<h6>$1</h6>"),i("back","$1<br/>"),i("paragraph","$1<br/>"),i("hr","$1 <hr />"),i("nbsp","$1&nbsp;"),i("bold","<strong>$1</strong>"),i("italic","<em>$1</em>"),i("strike","<del>$1</del>"),i("blockquote","<blockquote><p>$1</p></blockquote>","replaceLine"),i("link",'<a href="http://">$1</a>'),i("image",'<img src="http://" alt="$1">');var o=function(){if("html"==t.getCursorMode()){for(var e=t.editor,i=e.getDoc().getCursor(!0),o=e.getDoc().getCursor(!1),n=i.line;n<o.line+1;n++)e.replaceRange("<li>"+e.getLine(n)+"</li>",{line:n,ch:0},{line:n,ch:e.getLine(n).length});e.setCursor({line:o.line,ch:e.getLine(o.line).length}),e.focus()}};t.on("action.listUl",function(){o()}),t.on("action.listOl",function(){o()}),t.htmleditor.on("click",'a[data-htmleditor-button="fullscreen"]',function(){t.htmleditor.toggleClass("@-htmleditor-fullscreen");var i=t.editor.getWrapperElement();if(t.htmleditor.hasClass("@-htmleditor-fullscreen"))t.editor.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:i.style.width,height:i.style.height},i.style.width="",i.style.height=t.content.height()+"px",document.documentElement.style.overflow="hidden";else{document.documentElement.style.overflow="";var o=t.editor.state.fullScreenRestore;i.style.width=o.width,i.style.height=o.height,window.scrollTo(o.scrollLeft,o.scrollTop)}setTimeout(function(){t.fit(),e.$win.trigger("resize")},50)}),t.addShortcutAction("bold",["Ctrl-B","Cmd-B"])}}),e.plugin("htmleditor","markdown",{init:function(e){function i(){e.editor.setOption("mode","gfm"),e.htmleditor.find(".@-htmleditor-button-code a").html('<i class="@-icon-rz-visibility-mini"></i>')}function o(t,i,o){e.on("action."+t,function(){"markdown"==e.getCursorMode()&&e["replaceLine"==o?"replaceLine":"replaceSelection"](i)})}var n=e.options.marked||marked;n&&(n.setOptions(e.options.markedOptions),e.options.markdown&&i(),o("h2","##$1"),o("h3","###$1"),o("h4","####$1"),o("h5","#####$1"),o("h6","######$1"),o("back","$1   \n"),o("hr","$1 \n\n---\n\n"),o("nbsp","$1 "),o("bold","**$1**"),o("italic","*$1*"),o("strike","~~$1~~"),o("blockquote","> $1","replaceLine"),o("link","[$1](http://)"),o("image","![$1](http://)"),e.on("action.listUl",function(){if("markdown"==e.getCursorMode()){for(var t=e.editor,i=t.getDoc().getCursor(!0),o=t.getDoc().getCursor(!1),n=i.line;n<o.line+1;n++)t.replaceRange("* "+t.getLine(n),{line:n,ch:0},{line:n,ch:t.getLine(n).length});t.setCursor({line:o.line,ch:t.getLine(o.line).length}),t.focus()}}),e.on("action.listOl",function(){if("markdown"==e.getCursorMode()){var t=e.editor,i=t.getDoc().getCursor(!0),o=t.getDoc().getCursor(!1),n=1;if(i.line>0){var l,r=t.getLine(i.line-1);(l=r.match(/^(\d+)\./))&&(n=Number(l[1])+1)}for(var s=i.line;s<o.line+1;s++)t.replaceRange(n+". "+t.getLine(s),{line:s,ch:0},{line:s,ch:t.getLine(s).length}),n++;t.setCursor({line:o.line,ch:t.getLine(o.line).length}),t.focus()}}),e.on("renderLate",function(){"gfm"==e.editor.options.mode&&(e.currentvalue=n(e.currentvalue))}),e.on("cursorMode",function(t,i){if("gfm"==e.editor.options.mode){var o=e.editor.getDoc().getCursor();e.editor.getTokenAt(o).state.base.htmlState||(i.mode="markdown")}}),t.extend(e,{enableMarkdown:function(){i(),this.render()},disableMarkdown:function(){this.editor.setOption("mode","htmlmixed"),this.htmleditor.find(".@-htmleditor-button-code a").html(this.options.lblCodeview),this.render()}}),e.on({enableMarkdown:function(){e.enableMarkdown()},disableMarkdown:function(){e.disableMarkdown()}}))}}),e.htmleditor});