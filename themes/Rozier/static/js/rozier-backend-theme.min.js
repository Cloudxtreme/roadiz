/*! rozier-backend-theme 2014-12-04 18:32:01 */
function PointerEventsPolyfill(a){if(this.options={selector:"*",mouseEvents:["click","dblclick","mousedown","mouseup"],usePolyfillIf:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=navigator.userAgent;if(null!=a.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/)){var b=parseFloat(RegExp.$1);if(11>b)return!0}}return!1}},a){var b=this;$.each(a,function(a,c){b.options[a]=c})}this.options.usePolyfillIf()&&this.register_mouse_events()}var DocumentsBulk=function(){var a=this;a.$documentsCheckboxes=$("input.document-checkbox"),a.$documentsIdBulkFolders=$("input.document-id-bulk-folder"),a.$actionsMenu=$(".documents-bulk-actions"),a.$documentsFolderButton=$(".uk-button-bulk-folder-documents"),a.$documentsFolderCont=$(".documents-bulk-folder-cont"),a.$documentsCheckboxes.length&&a.init()};DocumentsBulk.prototype.$documentsCheckboxes=null,DocumentsBulk.prototype.$documentsIdBulkFolders=null,DocumentsBulk.prototype.$actionsMenu=null,DocumentsBulk.prototype.$documentsFolderButton=null,DocumentsBulk.prototype.$documentsFolderCont=null,DocumentsBulk.prototype.documentsFolderOpen=!1,DocumentsBulk.prototype.documentsIds=null,DocumentsBulk.prototype.init=function(){var a=this,b=$.proxy(a.onCheckboxChange,a);a.$documentsCheckboxes.off("change",b),a.$documentsCheckboxes.on("change",b);var c=a.$actionsMenu.find(".uk-button-bulk-delete-documents"),d=$.proxy(a.onBulkDelete,a);c.off("click",d),c.on("click",d),a.$documentsFolderButton.on("click",$.proxy(a.documentsFolderButtonClick,a));var e=a.$actionsMenu.find(".uk-button-bulk-download-documents"),f=$.proxy(a.onBulkDownload,a);e.off("click",f),e.on("click",f)},DocumentsBulk.prototype.onCheckboxChange=function(){var a=this;a.documentsIds=[],$("input.document-checkbox:checked").each(function(b,c){a.documentsIds.push($(c).val())}),a.$documentsIdBulkFolders.length&&a.$documentsIdBulkFolders.val(a.documentsIds.join(",")),a.documentsIds.length>0?a.showActions():a.hideActions()},DocumentsBulk.prototype.onBulkDelete=function(){var a=this;return a.documentsIds.length>0&&(history.pushState({headerData:{documents:a.documentsIds}},null,Rozier.routes.documentsBulkDeletePage),Rozier.lazyload.onPopState(null)),!1},DocumentsBulk.prototype.onBulkDownload=function(){var a=this;return a.documentsIds.length>0&&(history.pushState({headerData:{documents:a.documentsIds}},null,Rozier.routes.documentsBulkDownloadPage),Rozier.lazyload.onPopState(null)),!1},DocumentsBulk.prototype.showActions=function(){var a=this;a.$actionsMenu.slideDown()},DocumentsBulk.prototype.hideActions=function(){var a=this;a.$actionsMenu.slideUp()},DocumentsBulk.prototype.documentsFolderButtonClick=function(){var a=this;a.documentsFolderOpen?(a.$documentsFolderCont.slideUp(),a.documentsFolderOpen=!1):(a.$documentsFolderCont.slideDown(),a.documentsFolderOpen=!0)};var NodesBulk=function(){var a=this;a.$nodesCheckboxes=$("input.node-checkbox"),a.$nodesIdBulkTags=$("input.nodes-id-bulk-tags"),a.$actionsMenu=$(".nodes-bulk-actions"),a.$nodesFolderButton=$(".uk-button-bulk-folder-nodes"),a.$nodesFolderCont=$(".nodes-bulk-folder-cont"),a.$nodesCheckboxes.length&&a.init()};NodesBulk.prototype.$nodesCheckboxes=null,NodesBulk.prototype.$nodesIdBulkTags=null,NodesBulk.prototype.$actionsMenu=null,NodesBulk.prototype.$nodesFolderButton=null,NodesBulk.prototype.$nodesFolderCont=null,NodesBulk.prototype.nodesFolderOpen=!1,NodesBulk.prototype.nodesIds=null,NodesBulk.prototype.init=function(){var a=this,b=$.proxy(a.onCheckboxChange,a);a.$nodesCheckboxes.off("change",b),a.$nodesCheckboxes.on("change",b),a.$nodesFolderButton.on("click",$.proxy(a.nodesFolderButtonClick,a))},NodesBulk.prototype.onCheckboxChange=function(){var a=this;a.nodesIds=[],$("input.node-checkbox:checked").each(function(b,c){a.nodesIds.push($(c).val())}),a.$nodesIdBulkTags.length&&a.$nodesIdBulkTags.val(a.nodesIds.join(",")),console.log(a.nodesIds),a.nodesIds.length>0?a.showActions():a.hideActions()},NodesBulk.prototype.onBulkDelete=function(){var a=this;return a.nodesIds.length>0&&(history.pushState({headerData:{nodes:a.nodesIds}},null,Rozier.routes.nodesBulkDeletePage),Rozier.lazyload.onPopState(null)),!1},NodesBulk.prototype.showActions=function(){var a=this;a.$actionsMenu.slideDown()},NodesBulk.prototype.hideActions=function(){var a=this;a.$actionsMenu.slideUp()},NodesBulk.prototype.nodesFolderButtonClick=function(){var a=this;a.nodesFolderOpen?(a.$nodesFolderCont.slideUp(),a.nodesFolderOpen=!1):(a.$nodesFolderCont.slideDown(),a.nodesFolderOpen=!0)},DocumentsList=function(){var a=this;a.$cont=$(".documents-list"),a.$cont.length&&(a.$item=a.$cont.find(".document-item")),a.resize()},DocumentsList.prototype.$cont=null,DocumentsList.prototype.contWidth=null,DocumentsList.prototype.$item=null,DocumentsList.prototype.itemWidth=144,DocumentsList.prototype.itemsPerLine=4,DocumentsList.prototype.itemsWidth=576,DocumentsList.prototype.contMarginLeft=0,DocumentsList.prototype.resize=function(){var a=this;a.$cont.length&&(a.contWidth=a.$cont.actual("width"),a.itemsPerLine=Math.floor(a.contWidth/a.itemWidth),a.itemsWidth=a.itemWidth*a.itemsPerLine-16,a.contMarginLeft=Math.floor((a.contWidth-a.itemsWidth)/2),a.$cont[0].style.marginLeft=a.contMarginLeft+"px")};var DocumentWidget=function(){var a=this;a.$widgets=$("[data-document-widget]"),a.$sortables=$(".documents-widget-sortable"),a.$toggleExplorerButtons=$("[data-document-widget-toggle-explorer]"),a.$toggleUploaderButtons=$("[data-document-widget-toggle-uploader]"),a.$unlinkDocumentButtons=$("[data-document-widget-unlink-document]"),a.init()};DocumentWidget.prototype.$explorer=null,DocumentWidget.prototype.$explorerClose=null,DocumentWidget.prototype.$widgets=null,DocumentWidget.prototype.$toggleExplorerButtons=null,DocumentWidget.prototype.$unlinkDocumentButtons=null,DocumentWidget.prototype.$sortables=null,DocumentWidget.prototype.uploader=null,DocumentWidget.prototype.init=function(){var a=this,b=$.proxy(a.onSortableDocumentWidgetChange,a);a.$sortables.on("uk.sortable.change",b),a.$sortables.on("uk.sortable.change",b);var c=$.proxy(a.onExplorerToggle,a);a.$toggleExplorerButtons.off("click",c),a.$toggleExplorerButtons.on("click",c);var d=$.proxy(a.onUploaderToggle,a);a.$toggleUploaderButtons.off("click",d),a.$toggleUploaderButtons.on("click",d);var e=$.proxy(a.onUnlinkDocument,a);a.$unlinkDocumentButtons.off("click",e),a.$unlinkDocumentButtons.on("click",e),Rozier.$window.on("keyup",$.proxy(a.echapKey,a))},DocumentWidget.prototype.onSortableDocumentWidgetChange=function(a,b,c){console.log(c),$sortable=$(c).parent();var d="source["+$sortable.data("input-name")+"]";return $sortable.find("li").each(function(a){$(this).find("input").attr("name",d+"["+a+"]")}),!1},DocumentWidget.prototype.onUploaderToggle=function(a){var b=this,c=$(a.currentTarget),d=c.parents(".documents-widget");if(null!==b.uploader){b.uploader=null;var e=d.find(".documents-widget-uploader");e.slideUp(500,function(){e.remove(),c.removeClass("active")})}else{d.append('<div class="documents-widget-uploader dropzone"></div>');var f=d.find(".documents-widget-uploader"),g={selector:".documents-widget .documents-widget-uploader",headers:{_token:Rozier.ajaxToken},onSuccess:function(a){if(console.log(a),"undefined"!=typeof a.thumbnail){var c=d.find(".documents-widget-sortable");c.append(a.thumbnail.html);var e=c.find('[data-document-id="'+a.thumbnail.id+'"]');b.onSortableDocumentWidgetChange(null,c,e)}}};$.extend(g,Rozier.messages.dropzone),console.log(g),b.uploader=new DocumentUploader(g),f.slideDown(500),c.addClass("active")}return!1},DocumentWidget.prototype.onExplorerToggle=function(a){var b=this;if(null===b.$explorer){b.$toggleExplorerButtons.addClass("uk-active");var c={_action:"toggleExplorer",_token:Rozier.ajaxToken};Rozier.lazyload.canvasLoader.show(),$.ajax({url:Rozier.routes.documentsAjaxExplorer,type:"get",dataType:"json",data:c}).success(function(c){if(console.log(c),console.log("success"),Rozier.lazyload.canvasLoader.hide(),"undefined"!=typeof c.documents){var d=$($(a.currentTarget).parents(".documents-widget")[0]).find(".documents-widget-sortable");b.createExplorer(c,d)}}).fail(function(a){console.log(a.responseText),console.log("error")})}else b.closeExplorer();return!1},DocumentWidget.prototype.onExplorerSearch=function(a,b){var c=this;if(null!==c.$explorer){var d=$(b.currentTarget).find("#documents-search-input"),e={_action:"toggleExplorer",_token:Rozier.ajaxToken,search:d.val()};Rozier.lazyload.canvasLoader.show(),$.ajax({url:Rozier.routes.documentsAjaxExplorer,type:"get",dataType:"json",data:e}).success(function(b){console.log(b),console.log("success"),Rozier.lazyload.canvasLoader.hide(),"undefined"!=typeof b.documents&&c.appendItemsToExplorer(b,a,!0)}).fail(function(a){console.log(a.responseText),console.log("error")})}return!1},DocumentWidget.prototype.onExplorerNextPage=function(a,b){var c=this;if(null!==c.$explorer){console.log(a);var d={_action:"toggleExplorer",_token:Rozier.ajaxToken,search:a.search,page:a.nextPage};Rozier.lazyload.canvasLoader.show(),$.ajax({url:Rozier.routes.documentsAjaxExplorer,type:"get",dataType:"json",data:d}).success(function(a){console.log(a),console.log("success"),Rozier.lazyload.canvasLoader.hide(),"undefined"!=typeof a.documents&&c.appendItemsToExplorer(a,b)}).fail(function(a){console.log(a.responseText),console.log("error")})}return!1},DocumentWidget.prototype.onUnlinkDocument=function(a){var b=$(a.currentTarget),c=b.parents("li"),d=b.parents(".documents-widget-sortable").first();return c.remove(),d.trigger("uk.sortable.change",[d,c]),!1},DocumentWidget.prototype.createExplorer=function(a,b){var c=this,d=($.proxy(c.onSortableDocumentWidgetChange,c),['<div class="document-widget-explorer">','<div class="document-widget-explorer-header">','<div class="document-widget-explorer-logo"><i class="uk-icon-rz-folder-tree-mini"></i></div>','<div class="document-widget-explorer-search">','<form action="#" method="POST" class="explorer-search uk-form">','<div class="uk-form-icon">','<i class="uk-icon-search"></i>','<input id="documents-search-input" type="search" name="searchTerms" value="" placeholder="'+Rozier.messages.searchDocuments+'"/>',"</div>","</form>","</div>",'<div class="document-widget-explorer-close"><i class="uk-icon-rz-close-explorer"></i></div>',"</div>",'<ul class="uk-sortable"></ul>',"</div>"].join(""));$("body").append(d),c.$explorer=$(".document-widget-explorer"),c.$explorerClose=$(".document-widget-explorer-close"),c.$explorerClose.on("click",$.proxy(c.closeExplorer,c)),c.$explorer.find(".explorer-search").on("submit",$.proxy(c.onExplorerSearch,c,b)),c.appendItemsToExplorer(a,b),window.setTimeout(function(){c.$explorer.addClass("visible")},0)},DocumentWidget.prototype.appendItemsToExplorer=function(a,b,c){var d=this,e=d.$explorer.find(".uk-sortable");e.find(".document-widget-explorer-nextpage").remove(),"undefined"!=typeof c&&c===!0&&e.empty();for(var f=0;f<a.documents.length;f++){var g=a.documents[f];e.append(g.html)}var h=$.proxy(d.onAddDocumentClick,d,b),i=e.find(".link-button");i.on("click",h),"undefined"!=typeof a.filters.nextPage&&a.filters.nextPage>1&&(e.append(['<li class="document-widget-explorer-nextpage">','<i class="uk-icon-plus"></i><span class="label">'+Rozier.messages.moreDocuments+"</span>","</li>"].join("")),e.find(".document-widget-explorer-nextpage").on("click",$.proxy(d.onExplorerNextPage,d,a.filters,b)))},DocumentWidget.prototype.onAddDocumentClick=function(a,b){var c=$(b.currentTarget).parents(".uk-sortable-list-item");c.appendTo(a),console.log("click"),console.log(a),console.log(c);var d="source["+a.data("input-name")+"]";return a.find("li").each(function(a,b){$(b).find("input").attr("name",d+"["+a+"]")}),!1},DocumentWidget.prototype.echapKey=function(a){var b=this;return 27==a.keyCode&&null!==b.$explorer&&b.closeExplorer(),!1},DocumentWidget.prototype.closeExplorer=function(){var a=this;a.$toggleExplorerButtons.removeClass("uk-active"),a.$explorer.removeClass("visible"),a.$explorer.one("transitionend webkitTransitionEnd mozTransitionEnd msTransitionEnd",function(){a.$explorer.remove(),a.$explorer=null})};var NodeWidget=function(){var a=this;a.$widgets=$("[data-node-widget]"),a.$sortables=$(".nodes-widget-sortable"),a.$toggleExplorerButtons=$("[data-node-widget-toggle-explorer]"),a.$toggleUploaderButtons=$("[data-node-widget-toggle-uploader]"),a.$unlinkNodeButtons=$("[data-node-widget-unlink-node]"),a.init()};NodeWidget.prototype.$explorer=null,NodeWidget.prototype.$explorerClose=null,NodeWidget.prototype.$widgets=null,NodeWidget.prototype.$toggleExplorerButtons=null,NodeWidget.prototype.$unlinkNodeButtons=null,NodeWidget.prototype.$sortables=null,NodeWidget.prototype.uploader=null,NodeWidget.prototype.init=function(){var a=this,b=$.proxy(a.onSortableNodeWidgetChange,a);a.$sortables.on("uk.sortable.change",b),a.$sortables.on("uk.sortable.change",b);var c=$.proxy(a.onExplorerToggle,a);a.$toggleExplorerButtons.off("click",c),a.$toggleExplorerButtons.on("click",c);var d=$.proxy(a.onUnlinkNode,a);a.$unlinkNodeButtons.off("click",d),a.$unlinkNodeButtons.on("click",d),Rozier.$window.on("keyup",$.proxy(a.echapKey,a))},NodeWidget.prototype.onSortableNodeWidgetChange=function(a,b,c){console.log(c),$sortable=$(c).parent();var d="source["+$sortable.data("input-name")+"]";return $sortable.find("li").each(function(a){$(this).find("input").attr("name",d+"["+a+"]")}),!1},NodeWidget.prototype.onExplorerToggle=function(a){var b=this;if(null===b.$explorer){b.$toggleExplorerButtons.addClass("uk-active");var c={_action:"toggleExplorer",_token:Rozier.ajaxToken};$.ajax({url:Rozier.routes.nodesAjaxExplorer,type:"get",dataType:"json",data:c}).success(function(c){if(console.log(c),console.log("success"),"undefined"!=typeof c.nodes){var d=$($(a.currentTarget).parents(".nodes-widget")[0]).find(".nodes-widget-sortable");b.createExplorer(c,d)}}).fail(function(a){console.log(a.responseText),console.log("error")})}else b.closeExplorer();return!1},NodeWidget.prototype.onExplorerSearch=function(a,b){var c=this;if(null!==c.$explorer){var d=$(b.currentTarget).find("#nodes-search-input"),e={_action:"toggleExplorer",_token:Rozier.ajaxToken,search:d.val()};$.ajax({url:Rozier.routes.nodesAjaxExplorer,type:"get",dataType:"json",data:e}).success(function(b){console.log(b),console.log("success"),"undefined"!=typeof b.nodes&&c.appendItemsToExplorer(b,a,!0)}).fail(function(a){console.log(a.responseText),console.log("error")})}return!1},NodeWidget.prototype.onExplorerNextPage=function(a,b){var c=this;if(null!==c.$explorer){console.log(a);var d={_action:"toggleExplorer",_token:Rozier.ajaxToken,search:a.search,page:a.nextPage};$.ajax({url:Rozier.routes.nodesAjaxExplorer,type:"get",dataType:"json",data:d}).success(function(a){console.log(a),console.log("success"),"undefined"!=typeof a.nodes&&c.appendItemsToExplorer(a,b)}).fail(function(a){console.log(a.responseText),console.log("error")})}return!1},NodeWidget.prototype.onUnlinkNode=function(a){var b=$(a.currentTarget),c=b.parents("li"),d=b.parents(".nodes-widget-sortable").first();return c.remove(),d.trigger("uk.sortable.change",[d,c]),!1},NodeWidget.prototype.createExplorer=function(a,b){var c=this,d=($.proxy(c.onSortableNodeWidgetChange,c),['<div class="node-widget-explorer">','<div class="node-widget-explorer-header">','<div class="node-widget-explorer-search">','<form action="#" method="POST" class="explorer-search uk-form">','<div class="uk-form-icon">','<i class="uk-icon-search"></i>','<input id="nodes-search-input" type="search" name="searchTerms" value="" placeholder="'+Rozier.messages.searchNodes+'"/>',"</div>","</form>","</div>",'<div class="node-widget-explorer-close"><i class="uk-icon-rz-close-explorer"></i></div>',"</div>",'<ul class="uk-sortable"></ul>',"</div>"].join(""));$("body").append(d),c.$explorer=$(".node-widget-explorer"),c.$explorerClose=$(".node-widget-explorer-close"),c.$explorerClose.on("click",$.proxy(c.closeExplorer,c)),c.$explorer.find(".explorer-search").on("submit",$.proxy(c.onExplorerSearch,c,b)),c.appendItemsToExplorer(a,b),window.setTimeout(function(){c.$explorer.addClass("visible")},0)},NodeWidget.prototype.appendItemsToExplorer=function(a,b,c){var d=this,e=d.$explorer.find(".uk-sortable");e.find(".node-widget-explorer-nextpage").remove(),"undefined"!=typeof c&&c===!0&&e.empty();for(var f=0;f<a.nodes.length;f++){var g=a.nodes[f];e.append(g.html)}var h=$.proxy(d.onAddNodeClick,d,b),i=e.find(".link-button");i.on("click",h),"undefined"!=typeof a.filters.nextPage&&a.filters.nextPage>1&&(e.append(['<li class="node-widget-explorer-nextpage">','<i class="uk-icon-plus"></i><span class="label">'+Rozier.messages.moreNodes+"</span>","</li>"].join("")),e.find(".node-widget-explorer-nextpage").on("click",$.proxy(d.onExplorerNextPage,d,a.filters,b)))},NodeWidget.prototype.onAddNodeClick=function(a,b){var c=$(b.currentTarget).parents(".uk-sortable-list-item");c.appendTo(a);var d="source["+a.data("input-name")+"]";return a.find("li").each(function(a,b){$(b).find("input").attr("name",d+"["+a+"]")}),!1},NodeWidget.prototype.echapKey=function(a){var b=this;return 27==a.keyCode&&null!==b.$explorer&&b.closeExplorer(),!1},NodeWidget.prototype.closeExplorer=function(){var a=this;a.$toggleExplorerButtons.removeClass("uk-active"),a.$explorer.removeClass("visible"),a.$explorer.one("transitionend webkitTransitionEnd mozTransitionEnd msTransitionEnd",function(){a.$explorer.remove(),a.$explorer=null})};var CustomFormWidget=function(){var a=this;a.$widgets=$("[data-custom-form-widget]"),a.$sortables=$(".custom-forms-widget-sortable"),a.$toggleExplorerButtons=$("[data-custom-form-widget-toggle-explorer]"),a.$toggleUploaderButtons=$("[data-custom-form-widget-toggle-uploader]"),a.$unlinkCustomFormButtons=$("[data-custom-form-widget-unlink-custom-form]"),a.init()};CustomFormWidget.prototype.$explorer=null,CustomFormWidget.prototype.$explorerClose=null,CustomFormWidget.prototype.$widgets=null,CustomFormWidget.prototype.$toggleExplorerButtons=null,CustomFormWidget.prototype.$unlinkCustomFormButtons=null,CustomFormWidget.prototype.$sortables=null,CustomFormWidget.prototype.uploader=null,CustomFormWidget.prototype.init=function(){var a=this,b=$.proxy(a.onSortableCustomFormWidgetChange,a);a.$sortables.on("uk.sortable.change",b),a.$sortables.on("uk.sortable.change",b);var c=$.proxy(a.onExplorerToggle,a);a.$toggleExplorerButtons.off("click",c),a.$toggleExplorerButtons.on("click",c);var d=$.proxy(a.onUnlinkCustomForm,a);a.$unlinkCustomFormButtons.off("click",d),a.$unlinkCustomFormButtons.on("click",d),Rozier.$window.on("keyup",$.proxy(a.echapKey,a))},CustomFormWidget.prototype.onSortableCustomFormWidgetChange=function(a,b,c){console.log(c),$sortable=$(c).parent();var d="source["+$sortable.data("input-name")+"]";return $sortable.find("li").each(function(a){$(this).find("input").attr("name",d+"["+a+"]")}),!1},CustomFormWidget.prototype.onExplorerToggle=function(a){var b=this;if(null===b.$explorer){b.$toggleExplorerButtons.addClass("uk-active");var c={_action:"toggleExplorer",_token:Rozier.ajaxToken};$.ajax({url:Rozier.routes.customFormsAjaxExplorer,type:"get",dataType:"json",data:c}).success(function(c){if(console.log(c),console.log("success"),"undefined"!=typeof c.customForms){var d=$($(a.currentTarget).parents(".custom-forms-widget")[0]).find(".custom-forms-widget-sortable");b.createExplorer(c,d)}}).fail(function(a){console.log(a.responseText),console.log("error")})}else b.closeExplorer();return!1},CustomFormWidget.prototype.onExplorerSearch=function(a,b){var c=this;if(null!==c.$explorer){var d=$(b.currentTarget).find("#custom-forms-search-input"),e={_action:"toggleExplorer",_token:Rozier.ajaxToken,search:d.val()};$.ajax({url:Rozier.routes.customFormsAjaxExplorer,type:"get",dataType:"json",data:e}).success(function(b){console.log(b),console.log("success"),"undefined"!=typeof b.customForms&&c.appendItemsToExplorer(b,a,!0)}).fail(function(a){console.log(a.responseText),console.log("error")})}return!1},CustomFormWidget.prototype.onExplorerNextPage=function(a,b){var c=this;if(null!==c.$explorer){console.log(a);var d={_action:"toggleExplorer",_token:Rozier.ajaxToken,search:a.search,page:a.nextPage};$.ajax({url:Rozier.routes.customFormsAjaxExplorer,type:"get",dataType:"json",data:d}).success(function(a){console.log(a),console.log("success"),typeof a.custom-forms!="undefined"&&c.appendItemsToExplorer(a,b)}).fail(function(a){console.log(a.responseText),console.log("error")})}return!1},CustomFormWidget.prototype.onUnlinkCustomForm=function(a){var b=$(a.currentTarget),c=b.parents("li"),d=b.parents(".custom-forms-widget-sortable").first();return c.remove(),d.trigger("uk.sortable.change",[d,c]),!1},CustomFormWidget.prototype.createExplorer=function(a,b){var c=this,d=($.proxy(c.onSortableCustomFormWidgetChange,c),['<div class="custom-form-widget-explorer">','<div class="custom-form-widget-explorer-header">','<div class="custom-form-widget-explorer-search">','<form action="#" method="POST" class="explorer-search uk-form">','<div class="uk-form-icon">','<i class="uk-icon-search"></i>','<input id="custom-forms-search-input" type="search" name="searchTerms" value="" placeholder="'+Rozier.messages.searchCustomForms+'"/>',"</div>","</form>","</div>",'<div class="custom-form-widget-explorer-close"><i class="uk-icon-rz-close-explorer"></i></div>',"</div>",'<ul class="uk-sortable"></ul>',"</div>"].join(""));$("body").append(d),c.$explorer=$(".custom-form-widget-explorer"),c.$explorerClose=$(".custom-form-widget-explorer-close"),c.$explorerClose.on("click",$.proxy(c.closeExplorer,c)),c.$explorer.find(".explorer-search").on("submit",$.proxy(c.onExplorerSearch,c,b)),c.appendItemsToExplorer(a,b),window.setTimeout(function(){c.$explorer.addClass("visible")},0)},CustomFormWidget.prototype.appendItemsToExplorer=function(a,b,c){var d=this,e=d.$explorer.find(".uk-sortable");e.find(".custom-form-widget-explorer-nextpage").remove(),"undefined"!=typeof c&&c===!0&&e.empty();for(var f=0;f<a.customForms.length;f++){var g=a.customForms[f];e.append(g.html)}var h=$.proxy(d.onAddCustomFormClick,d,b),i=e.find(".link-button");i.on("click",h),"undefined"!=typeof a.filters.nextPage&&a.filters.nextPage>1&&(e.append(['<li class="custom-form-widget-explorer-nextpage">','<i class="uk-icon-plus"></i><span class="label">'+Rozier.messages.moreCustomForms+"</span>","</li>"].join("")),e.find(".custom-form-widget-explorer-nextpage").on("click",$.proxy(d.onExplorerNextPage,d,a.filters,b)))},CustomFormWidget.prototype.onAddCustomFormClick=function(a,b){var c=$(b.currentTarget).parents(".uk-sortable-list-item");c.appendTo(a);var d="source["+a.data("input-name")+"]";return a.find("li").each(function(a,b){$(b).find("input").attr("name",d+"["+a+"]")}),!1},CustomFormWidget.prototype.echapKey=function(a){var b=this;return 27==a.keyCode&&null!==b.$explorer&&b.closeExplorer(),!1},CustomFormWidget.prototype.closeExplorer=function(){var a=this;a.$toggleExplorerButtons.removeClass("uk-active"),a.$explorer.removeClass("visible"),a.$explorer.one("transitionend webkitTransitionEnd mozTransitionEnd msTransitionEnd",function(){a.$explorer.remove(),a.$explorer=null})};var DocumentUploader=function(a){var b=this;b.options={onSuccess:function(a){console.log("Success file"),console.log(a)},onError:function(a){console.log("Failed file"),console.log(a)},onAdded:function(){console.log("Added file")},url:Rozier.routes.documentsUploadPage,selector:"#upload-dropzone-document",paramName:"form[attachment]",uploadMultiple:!1,maxFilesize:64,autoDiscover:!1,headers:{_token:Rozier.ajaxToken},dictDefaultMessage:"Drop files here to upload or click to open your explorer",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files."},"undefined"!=typeof a&&$.extend(b.options,a),$(b.options.selector).length&&b.init()};DocumentUploader.prototype.options=null,DocumentUploader.prototype.init=function(){var a=this,b=$("#upload-dropzone-document");isset(b.attr("data-folder-id"))&&b.attr("data-folder-id")>0&&(a.options.headers.folderId=parseInt(b.attr("data-folder-id")),a.options.url=Rozier.routes.documentsUploadPage+"/"+parseInt(b.attr("data-folder-id"))),Dropzone.options.uploadDropzoneDocument={url:a.options.url,method:"post",headers:a.options.headers,paramName:a.options.paramName,uploadMultiple:a.options.uploadMultiple,maxFilesize:a.options.maxFilesize,dictDefaultMessage:a.options.dictDefaultMessage,dictFallbackMessage:a.options.dictFallbackMessage,dictFallbackText:a.options.dictFallbackText,dictFileTooBig:a.options.dictFileTooBig,dictInvalidFileType:a.options.dictInvalidFileType,dictResponseError:a.options.dictResponseError,dictCancelUpload:a.options.dictCancelUpload,dictCancelUploadConfirmation:a.options.dictCancelUploadConfirmation,dictRemoveFile:a.options.dictRemoveFile,dictRemoveFileConfirmation:a.options.dictRemoveFileConfirmation,dictMaxFilesExceeded:a.options.dictMaxFilesExceeded,init:function(){this.on("addedfile",function(b){a.options.onAdded(b)}),this.on("success",function(b,c){console.log(c),a.options.onSuccess(JSON.parse(c)),Rozier.getMessages()}),this.on("canceled",function(b,c){a.options.onError(JSON.parse(c)),Rozier.getMessages()})}},Dropzone.autoDiscover=a.options.autoDiscover;new Dropzone(a.options.selector,Dropzone.options.uploadDropzoneDocument)};var SaveButtons=function(){var a=this;a.$button=$($(".rz-action-save").get(0)),a.$actionMenu=$($(".actions-menu").get(0)),a.bindKeyboard(),a.$button.length&&a.$actionMenu.length&&a.init()};SaveButtons.prototype.$button=null,SaveButtons.prototype.$actionMenu=null,SaveButtons.prototype.init=function(){var a=this,b=$(a.$button.attr("data-action-save"));b.length&&(a.$button.prependTo(a.$actionMenu),a.$button.on("click",function(){b.submit()}),Mousetrap.bind(["mod+s"],function(){return console.log("Save requested"),b.submit(),!1}))},SaveButtons.prototype.bindKeyboard=function(){Mousetrap.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:"SELECT"==b.tagName}},SettingsSaveButtons=function(){var a=this;a.$button=$(".uk-button-settings-save"),a.$button.length&&a.init()},SettingsSaveButtons.prototype.$button=null,SettingsSaveButtons.prototype.init=function(){var a=this;a.$button.off("click",$.proxy(a.buttonClick,a)),a.$button.on("click",$.proxy(a.buttonClick,a))},SettingsSaveButtons.prototype.buttonClick=function(a){return $(a.currentTarget).parent().parent().find(".uk-form").submit(),!1},SettingsSaveButtons.prototype.resize=function(){},NodeEditSource=function(){var a=this;a.$content=$(".content-node-edit-source"),a.$content.length&&a.init()},NodeEditSource.prototype.$content=null,NodeEditSource.prototype.$input=null,NodeEditSource.prototype.init=function(){var a=this;a.$input=a.$content.find("input, select");for(var b=0;b<a.$input.length;b++)""!==a.$input[b].getAttribute("data-desc")&&$(a.$input[b]).after('<div class="form-help uk-alert uk-alert-large">'+a.$input[b].getAttribute("data-desc")+"</div>");a.$input.on("focus",$.proxy(a.inputFocus,a)),a.$input.on("focusout",$.proxy(a.inputFocusOut,a))},NodeEditSource.prototype.inputFocus=function(a){$(a.currentTarget).parent().addClass("form-col-focus")},NodeEditSource.prototype.inputFocusOut=function(a){$(a.currentTarget).parent().removeClass("form-col-focus")},NodeEditSource.prototype.destroy=function(){},NodeEditSource.prototype.resize=function(){};var NodeStatuses=function(){var a=this;a.$containers=$(".node-statuses"),a.$icon=$(".node-status header i"),a.$inputs=a.$containers.find('input[type="checkbox"], input[type="radio"]'),a.$item=a.$containers.find(".node-statuses-item"),a.init()};NodeStatuses.prototype.$containers=null,NodeStatuses.prototype.$icon=null,NodeStatuses.prototype.$inputs=null,NodeStatuses.prototype.$item=null,NodeStatuses.prototype.init=function(){var a=this;a.$item.on("click",$.proxy(a.itemClick,a)),a.$inputs.off("change",$.proxy(a.onChange,a)),a.$inputs.on("change",$.proxy(a.onChange,a)),a.$containers.find(".rz-boolean-checkbox").bootstrapSwitch({onSwitchChange:$.proxy(a.onChange,a)})},NodeStatuses.prototype.itemClick=function(a){$input=$(a.currentTarget).find('input[type="radio"]'),$input.length&&($input.prop("checked",!0),$input.trigger("change"))},NodeStatuses.prototype.onChange=function(a){var b=this,c=$(a.currentTarget);if(c.length){var d=c.attr("name"),e=null;c.is('input[type="checkbox"]')?e=Number(c.is(":checked")):c.is('input[type="radio"]')&&(b.$icon[0].className=c.parent().find("i")[0].className,e=Number(c.val()));var f={_token:Rozier.ajaxToken,_action:"nodeChangeStatus",nodeId:parseInt(c.attr("data-node-id")),statusName:d,statusValue:e};console.log(f),$.ajax({url:Rozier.routes.nodesStatusesAjax,type:"post",dataType:"json",data:f}).done(function(a){console.log(a),Rozier.refreshMainNodeTree(),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a.responseJSON),a=JSON.parse(a.responseText),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){})}},NodeTypeFieldEdit=function(){var a=this;a.$btn=$(".node-type-field-edit-button"),a.$formFieldRow=$(".node-type-field-row"),a.init()},NodeTypeFieldEdit.prototype.$btn=null,NodeTypeFieldEdit.prototype.indexOpen=null,NodeTypeFieldEdit.prototype.openFormDelay=0,NodeTypeFieldEdit.prototype.$formRow=null,NodeTypeFieldEdit.prototype.$formRow=null,NodeTypeFieldEdit.prototype.$formCont=null,NodeTypeFieldEdit.prototype.$form=null,NodeTypeFieldEdit.prototype.$formIcon=null,NodeTypeFieldEdit.prototype.$formContHeight=null,NodeTypeFieldEdit.prototype.init=function(){var a=this;a.$btn.on("click",$.proxy(a.btnClick,a))},NodeTypeFieldEdit.prototype.btnClick=function(a){var b=this;return null!==b.indexOpen?(b.closeForm(),b.openFormDelay=500):b.openFormDelay=0,b.indexOpen!==parseInt(a.currentTarget.getAttribute("data-index"))&&setTimeout(function(){b.indexOpen=parseInt(a.currentTarget.getAttribute("data-index")),$.ajax({url:a.currentTarget.href,type:"get",dataType:"html"}).done(function(c){b.applyContent(a.currentTarget,c,a.currentTarget.href)}).fail(function(){console.log("error"),$.UIkit.notify({message:Rozier.messages.forbiddenPage,status:"danger",timeout:3e3,pos:"top-center"})})},b.openFormDelay),!1},NodeTypeFieldEdit.prototype.applyContent=function(a,b,c){var d=this,e=['<tr class="node-type-field-edit-form-row">','<td colspan="4">','<div class="node-type-field-edit-form-cont">',b,"</div>","</td>","</tr>"].join("");$(a).parent().parent().after(e),setTimeout(function(){d.$formCont=$(".node-type-field-edit-form-cont"),d.formContHeight=d.$formCont.actual("height"),d.$formRow=$(".node-type-field-edit-form-row"),d.$form=$("#edit-node-type-field-form"),d.$formIcon=$(d.$formFieldRow[d.indexOpen]).find(".node-type-field-col-1 i"),d.$form.attr("action",c),d.$formIcon[0].className="uk-icon-chevron-down",d.$formCont[0].style.height="0px",d.$formCont[0].style.display="block",TweenLite.to(d.$form,.6,{height:d.formContHeight,ease:Expo.easeOut}),TweenLite.to(d.$formCont,.6,{height:d.formContHeight,ease:Expo.easeOut})},200)},NodeTypeFieldEdit.prototype.closeForm=function(){var a=this;a.$formIcon[0].className="uk-icon-chevron-right",TweenLite.to(a.$formCont,.4,{height:0,ease:Expo.easeOut,onComplete:function(){a.$formRow.remove(),a.indexOpen=null}})},NodeTypeFieldEdit.prototype.resize=function(){};var GeotagField=function(){var a=this;a.$fields=$("input.rz-geotag-field"),a.$fields.length&&""!==Rozier.googleClientId&&a.init()};GeotagField.prototype.geocoder=null,GeotagField.prototype.$fields=null,GeotagField.prototype.init=function(){var a=this;
if(Rozier.gMapLoaded)a.bindFields();else{var b=document.createElement("script");b.type="text/javascript",b.src="//maps.googleapis.com/maps/api/js?key="+Rozier.googleClientId+"&callback=initializeGeotagFields",document.body.appendChild(b)}},GeotagField.prototype.bindFields=function(){var a=this;a.geocoder=new google.maps.Geocoder,a.$fields.each(function(b,c){a.bindSingleField(c)})},GeotagField.prototype.bindSingleField=function(a){var b=this,c=$(a),d={lat:45.769785,lng:4.833967,zoom:14},e="geotag-canvas-"+GeotagField.uniqid(),f=e+"-address",g=e+"-reset",h={center:new google.maps.LatLng(d.lat,d.lng),zoom:d.zoom,styles:Rozier.mapsStyle};c.hide(),c.attr("data-geotag-canvas",e),c.after('<div class="rz-geotag-canvas" id="'+e+'" style="width: 100%; height: 400px;"></div>');var i='<nav class="rz-geotag-meta"><input class="rz-geotag-address" id="'+f+'" type="text" value="" />';i+='<a id="'+g+'" class="uk-button uk-button-content uk-button-table-delete rz-geotag-reset" title="'+Rozier.messages.geotag.resetMarker+'" data-uk-tooltip="{animation:true}"><i class="uk-icon-rz-trash-o"></i></a></nav>',c.after(i);var j=$("#"+f);j.attr("placeholder",Rozier.messages.geotag.typeAnAddress);var k=$("#"+g);k.hide();var l=new google.maps.Map(document.getElementById(e),h),m=null;if(""!==c.val())try{d=JSON.parse(c.val()),m=b.createMarker(d,c,l),k.show()}catch(n){return c.show(),$(document.getElementById(e)).hide(),!1}else m=new google.maps.Marker({draggable:!0,position:h.center,animation:google.maps.Animation.DROP});google.maps.event.addListener(m,"dragend",$.proxy(b.setMarkerEvent,b,m,c,k,l)),google.maps.event.addListener(l,"click",$.proxy(b.setMarkerEvent,b,m,c,k,l)),j.on("keypress",$.proxy(b.requestGeocode,b,m,c,k,l)),k.on("click",$.proxy(b.resetMarker,b,m,c,k,l)),setTimeout(function(){google.maps.event.trigger(l,"resize"),l.panTo(null!==m?m.getPosition():h.center)},500)},GeotagField.prototype.resetMarker=function(a,b,c){return a.setMap(null),b.val(""),c.hide(),!1},GeotagField.prototype.setMarkerEvent=function(a,b,c,d,e){var f=this;f.setMarker(a,b,c,d,e.latLng)},GeotagField.prototype.setMarker=function(a,b,c,d,e){a.setPosition(e),a.setMap(d),d.panTo(e);var f={lat:e.lat(),lng:e.lng(),zoom:d.getZoom()};b.val(JSON.stringify(f)),c.show()},GeotagField.prototype.createMarker=function(a,b,c){var d=new google.maps.LatLng(a.lat,a.lng),e=new google.maps.Marker({map:c,draggable:!0,animation:google.maps.Animation.DROP,position:d});return c.panTo(d),c.setZoom(a.zoom),e},GeotagField.prototype.requestGeocode=function(a,b,c,d,e){var f=this,g=e.currentTarget.value;return 13==e.which?(e.preventDefault(),f.geocoder.geocode({address:g},function(e,g){g==google.maps.GeocoderStatus.OK?f.setMarker(a,b,c,d,e[0].geometry.location):console.err("Geocode was not successful for the following reason: "+g)}),!1):void 0};var initializeGeotagFields=function(){Rozier.gMapLoaded=!0,new GeotagField};GeotagField.uniqid=function(){var a=new Date;return a.getTime()};var ChildrenNodesField=function(){var a=this;a.$fields=$("[data-children-nodes-widget]"),a.$quickAddNodeButtons=a.$fields.find(".children-nodes-quick-creation a"),a.init()};ChildrenNodesField.prototype.$fields=null,ChildrenNodesField.prototype.$quickAddNodeButtons=null,ChildrenNodesField.prototype.init=function(){var a=this;if(a.$quickAddNodeButtons.length){var b=$.proxy(a.onQuickAddClick,a);a.$quickAddNodeButtons.off("click",b),a.$quickAddNodeButtons.on("click",b)}a.$fields.find(".nodetree-langs").remove()},ChildrenNodesField.prototype.onQuickAddClick=function(a){var b=this,c=$(a.currentTarget),d=parseInt(c.attr("data-children-node-type")),e=parseInt(c.attr("data-children-parent-node")),f=parseInt(c.attr("data-translation-id"));if(d>0&&e>0){var g={_token:Rozier.ajaxToken,_action:"quickAddNode",nodeTypeId:d,parentNodeId:e,translationId:f};$.ajax({url:Rozier.routes.nodesQuickAddAjax,type:"post",dataType:"json",data:g}).done(function(a){console.log("success"),console.log(a),Rozier.refreshMainNodeTree();var d=c.parents(".children-nodes-widget").find(".nodetree-widget");b.refreshNodeTree(d,e,f),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log("error"),console.log(a),a=JSON.parse(a.responseText),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){console.log("complete")})}return!1},ChildrenNodesField.prototype.refreshNodeTree=function(a,b,c){var d=this;if(a.length){Rozier.lazyload.canvasLoader.show();var e={_token:Rozier.ajaxToken,_action:"requestNodeTree",parentNodeId:parseInt(b)},f=Rozier.routes.nodesTreeAjax;isset(c)&&c>0&&(f+="/"+c),$.ajax({url:f,type:"post",dataType:"json",data:e}).done(function(b){a.length&&"undefined"!=typeof b.nodeTree&&a.fadeOut("slow",function(){var c=a.parents(".children-nodes-widget");a.replaceWith(b.nodeTree),a=c.find(".nodetree-widget"),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.lazyload.generalBind(),a.fadeIn(),d.$fields.find(".nodetree-langs").remove(),Rozier.lazyload.canvasLoader.hide()})}).fail(function(a){console.log(a.responseJSON)})}else console.error("No node-tree available.")},MarkdownEditor=function(){var a=this;a.$cont=$(".uk-htmleditor"),a.$textarea=a.$cont.find(".markdown_textarea"),setTimeout(function(){a.init()},0)},MarkdownEditor.prototype.$cont=null,MarkdownEditor.prototype.$textarea=null,MarkdownEditor.prototype.$buttonCode=null,MarkdownEditor.prototype.$buttonPreview=null,MarkdownEditor.prototype.$buttonFullscreen=null,MarkdownEditor.prototype.$count=null,MarkdownEditor.prototype.$countCurrent=null,MarkdownEditor.prototype.limit=[],MarkdownEditor.prototype.countMinLimit=[],MarkdownEditor.prototype.countMaxLimit=[],MarkdownEditor.prototype.$countMaxLimitText=null,MarkdownEditor.prototype.countAlertActive=[],MarkdownEditor.prototype.fullscreenActive=[],MarkdownEditor.prototype.init=function(){var a=this;if(a.$cont.length&&a.$textarea.length){for(var b=0;b<a.$cont.length;b++)$(a.$cont[b]).find(".uk-htmleditor-button-code").attr("data-index",b),$(a.$cont[b]).find(".uk-htmleditor-button-preview").attr("data-index",b),$(a.$cont[b]).find(".uk-htmleditor-button-fullscreen").attr("data-index",b),$(a.$cont[b]).find(".markdown_textarea").attr("data-index",b),$(a.$cont[b]).find(".CodeMirror").attr("data-index",b),""!==a.$textarea[b].getAttribute("data-desc")&&$(a.$cont[b]).after('<div class="form-help uk-alert uk-alert-large">'+a.$textarea[b].getAttribute("data-desc")+"</div>"),""!==a.$textarea[b].getAttribute("data-max-length")&&(a.limit[b]=!0,a.countMaxLimit[b]=parseInt(a.$textarea[b].getAttribute("data-max-length")),$(a.$cont[b]).find(".count-current")[0].innerHTML=stripTags(Rozier.lazyload.htmlEditor[b].currentvalue).length,$(a.$cont[b]).find(".count-limit")[0].innerHTML=a.$textarea[b].getAttribute("data-max-length"),$(a.$cont[b]).find(".uk-htmleditor-count")[0].style.display="block"),""!==a.$textarea[b].getAttribute("data-min-length")&&(a.limit[b]=!0,a.countMinLimit[b]=parseInt(a.$textarea[b].getAttribute("data-min-length"))),""===a.$textarea[b].getAttribute("data-min-length")&&""===a.$textarea[b].getAttribute("data-max-length")&&(a.limit[b]=!1,a.countMaxLimit[b]=null,a.countAlertActive[b]=null),a.fullscreenActive[b]=!1,a.limit[b]&&(stripTags(Rozier.lazyload.htmlEditor[b].currentvalue).length>a.countMaxLimit[b]?(a.countAlertActive[b]=!0,addClass(a.$cont[b],"content-limit")):stripTags(Rozier.lazyload.htmlEditor[b].currentvalue).length<a.countMinLimit[b]?(a.countAlertActive[b]=!0,addClass(a.$cont[b],"content-limit")):a.countAlertActive[b]=!1),$(a.$cont[b]).find(".CodeMirror").on("keyup",$.proxy(a.textareaChange,a));a.$content=a.$cont.find(".uk-htmleditor-content"),a.$buttonCode=a.$cont.find(".uk-htmleditor-button-code"),a.$buttonPreview=a.$cont.find(".uk-htmleditor-button-preview"),a.$buttonFullscreen=a.$cont.find(".uk-htmleditor-button-fullscreen"),a.$count=a.$cont.find(".uk-htmleditor-count"),a.$countCurrent=a.$cont.find(".count-current"),a.$countMaxLimitText=a.$cont.find(".count-limit");for(var c=0;c<Rozier.lazyload.$textAreaHTMLeditor.length;c++)Rozier.lazyload.htmlEditor[c].editor.on("focus",$.proxy(a.textareaFocus,a)),Rozier.lazyload.htmlEditor[c].editor.on("blur",$.proxy(a.textareaFocusOut,a));a.$buttonPreview.on("click",$.proxy(a.buttonPreviewClick,a)),a.$buttonCode.on("click",$.proxy(a.buttonCodeClick,a)),a.$buttonFullscreen.on("click",$.proxy(a.buttonFullscreenClick,a)),Rozier.$window.on("keyup",$.proxy(a.echapKey,a))}},MarkdownEditor.prototype.textareaChange=function(a){var b=this,c=parseInt(a.currentTarget.getAttribute("data-index"));b.limit[c]&&setTimeout(function(){var a=Rozier.lazyload.htmlEditor[c].currentvalue,d=stripTags(a),e=d.length;b.$countCurrent[c].innerHTML=e,e>b.countMaxLimit[c]?b.countAlertActive[c]||(addClass(b.$cont[c],"content-limit"),b.countAlertActive[c]=!0):e<b.countMinLimit[c]?(console.log("inf limit "),b.countAlertActive[c]||(addClass(b.$cont[c],"content-limit"),b.countAlertActive[c]=!0)):b.countAlertActive[c]&&(removeClass(b.$cont[c],"content-limit"),b.countAlertActive[c]=!1)},100)},MarkdownEditor.prototype.textareaFocus=function(a){$(a.display.wrapper).parent().parent().parent().parent().addClass("form-col-focus")},MarkdownEditor.prototype.textareaFocusOut=function(a){$(a.display.wrapper).parent().parent().parent().parent().removeClass("form-col-focus")},MarkdownEditor.prototype.buttonPreviewClick=function(a){var b=this,c=parseInt(a.currentTarget.getAttribute("data-index"));b.$buttonCode[c].style.display="block",TweenLite.to(b.$buttonCode[c],.5,{opacity:1,ease:Expo.easeOut}),TweenLite.to(b.$buttonPreview[c],.5,{opacity:0,ease:Expo.easeOut,onComplete:function(){b.$buttonPreview[c].style.display="none"}})},MarkdownEditor.prototype.buttonCodeClick=function(a){var b=this,c=parseInt(a.currentTarget.getAttribute("data-index"));b.$buttonPreview[c].style.display="block",TweenLite.to(b.$buttonPreview[c],.5,{opacity:1,ease:Expo.easeOut}),TweenLite.to(b.$buttonCode[c],.5,{opacity:0,ease:Expo.easeOut,onComplete:function(){b.$buttonCode[c].style.display="none"}})},MarkdownEditor.prototype.buttonFullscreenClick=function(a){var b=this,c=parseInt(a.currentTarget.getAttribute("data-index")),d=$(b.$buttonFullscreen[c]).find("i");b.fullscreenActive[c]?(d[0].className="uk-icon-rz-fullscreen",b.fullscreenActive[c]=!1):(d[0].className="uk-icon-rz-fullscreen-off",b.fullscreenActive[c]=!0)},MarkdownEditor.prototype.echapKey=function(a){var b=this;if(27==a.keyCode)for(var c=0;c<b.$cont.length;c++)if(b.fullscreenActive[c]){$(b.$buttonFullscreen[c]).find("a").trigger("click");break}return!1},MarkdownEditor.prototype.resize=function(){};var TagAutocomplete=function(){function a(a){return a.split(/,\s*/)}function b(b){return a(b).pop()}$(".rz-tag-autocomplete").bind("keydown",function(a){a.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&a.preventDefault()}).autocomplete({source:function(a,c){$.getJSON(Rozier.routes.tagAjaxSearch,{_action:"tagAutocomplete",_token:Rozier.ajaxToken,search:b(a.term)},c)},search:function(){var a=b(this.value);return a.length<2?!1:void 0},focus:function(){return!1},select:function(b,c){var d=a(this.value);return d.pop(),d.push(c.item.value),d.push(""),this.value=d.join(", "),!1}})},FolderAutocomplete=function(){function a(a){return a.split(/,\s*/)}function b(b){return a(b).pop()}$(".rz-folder-autocomplete").bind("keydown",function(a){a.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&a.preventDefault()}).autocomplete({source:function(a,c){$.getJSON(Rozier.routes.foldersAjaxSearch,{_action:"folderAutocomplete",_token:Rozier.ajaxToken,search:b(a.term)},c)},search:function(){var a=b(this.value);return a.length<2?!1:void 0},focus:function(){return!1},select:function(b,c){var d=a(this.value);return d.pop(),d.push(c.item.value),d.push(""),this.value=d.join(", "),!1}})},StackNodeTree=function(){var a=this;a.$page=$(".stack-tree"),a.$quickAddNodeButtons=a.$page.find(".stack-tree-quick-creation a"),a.$switchLangButtons=a.$page.find(".nodetree-langs a"),a.init()};StackNodeTree.prototype.$page=null,StackNodeTree.prototype.$switchLangButtons=null,StackNodeTree.prototype.$quickAddNodeButtons=null,StackNodeTree.prototype.init=function(){var a=this;if(a.$quickAddNodeButtons.length){var b=$.proxy(a.onQuickAddClick,a);if(a.$quickAddNodeButtons.off("click",b),a.$quickAddNodeButtons.on("click",b),a.$switchLangButtons.length){var c=$.proxy(a.onChangeLangClick,a);a.$switchLangButtons.off("click",c),a.$switchLangButtons.on("click",c)}}},StackNodeTree.prototype.onChangeLangClick=function(a){var b=this,c=$(a.currentTarget),d=(b.$page.find(".nodetree-widget"),parseInt(c.attr("data-children-parent-node"))),e=parseInt(c.attr("data-translation-id"));return b.refreshNodeTree(d,e),!1},StackNodeTree.prototype.onQuickAddClick=function(a){var b=this,c=$(a.currentTarget),d=parseInt(c.attr("data-children-node-type")),e=parseInt(c.attr("data-children-parent-node"));if(d>0&&e>0){var f={_token:Rozier.ajaxToken,_action:"quickAddNode",nodeTypeId:d,parentNodeId:e,pushTop:1};$.ajax({url:Rozier.routes.nodesQuickAddAjax,type:"post",dataType:"json",data:f}).done(function(a){console.log("success"),console.log(a),Rozier.refreshMainNodeTree(),b.refreshNodeTree(e),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log("error"),console.log(a),a=JSON.parse(a.responseText),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).always(function(){console.log("complete")})}return!1},StackNodeTree.prototype.refreshNodeTree=function(a,b){var c=this,d=c.$page.find(".nodetree-widget");if(d.length){Rozier.lazyload.canvasLoader.show();var e={_token:Rozier.ajaxToken,_action:"requestNodeTree",stackTree:!0,parentNodeId:parseInt(a)},f=Rozier.routes.nodesTreeAjax;isset(b)&&b>0&&(f+="/"+b),$.ajax({url:f,type:"post",dataType:"json",data:e}).done(function(a){d.length&&"undefined"!=typeof a.nodeTree&&d.fadeOut("slow",function(){if(d.replaceWith(a.nodeTree),d=c.$page.find(".nodetree-widget"),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.lazyload.generalBind(),d.fadeIn(),Rozier.resize(),c.$switchLangButtons=c.$page.find(".nodetree-langs a"),c.$switchLangButtons.length){var b=$.proxy(c.onChangeLangClick,c);c.$switchLangButtons.off("click",b),c.$switchLangButtons.on("click",b)}Rozier.lazyload.canvasLoader.hide()})}).fail(function(a){console.log(a.responseJSON)})}else console.error("No node-tree available.")};var NodeTypeFieldsPosition=function(){var a=this;a.$list=$(".node-type-fields > .uk-sortable"),a.init()};NodeTypeFieldsPosition.prototype.$list=null,NodeTypeFieldsPosition.prototype.init=function(){var a=this;if(a.$list.length&&a.$list.children().length>1){var b=$.proxy(a.onSortableChange,a);a.$list.off("uk.sortable.change",b),a.$list.on("uk.sortable.change",b)}},NodeTypeFieldsPosition.prototype.onSortableChange=function(a,b,c){var d=$(c),e=parseInt(d.data("field-id")),f=d.prev(),g=0;0===f.length?(f=d.next(),g=parseInt(f.data("position"))-.5):g=parseInt(f.data("position"))+.5,console.log("nodeTypeFieldId="+e+"; newPosition="+g);var h={_token:Rozier.ajaxToken,_action:"updatePosition",nodeTypeFieldId:e,newPosition:g};$.ajax({url:Rozier.routes.nodeTypesFieldAjaxEdit.replace("%nodeTypeFieldId%",e),type:"POST",dataType:"json",data:h}).done(function(a){console.log(a),d.attr("data-position",g),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)}).always(function(){console.log("complete")})};var CustomFormFieldsPosition=function(){var a=this;a.$list=$(".custom-form-fields > .uk-sortable"),a.init()};CustomFormFieldsPosition.prototype.$list=null,CustomFormFieldsPosition.prototype.init=function(){var a=this;if(a.$list.length&&a.$list.children().length>1){var b=$.proxy(a.onSortableChange,a);a.$list.off("uk.sortable.change",b),a.$list.on("uk.sortable.change",b)}},CustomFormFieldsPosition.prototype.onSortableChange=function(a,b,c){var d=$(c),e=parseInt(d.data("field-id")),f=d.prev(),g=0;0===f.length?(f=d.next(),g=parseInt(f.data("position"))-.5):g=parseInt(f.data("position"))+.5,console.log("customFormFieldId="+e+"; newPosition="+g);var h={_token:Rozier.ajaxToken,_action:"updatePosition",customFormFieldId:e,newPosition:g};$.ajax({url:Rozier.routes.customFormsFieldAjaxEdit.replace("%customFormFieldId%",e),type:"POST",dataType:"json",data:h}).done(function(a){console.log(a),d.attr("data-position",g),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)}).always(function(){console.log("complete")})},CustomFormFieldEdit=function(){var a=this;a.$btn=$(".custom-form-field-edit-button"),a.$formFieldRow=$(".custom-form-field-row"),a.init()},CustomFormFieldEdit.prototype.$btn=null,CustomFormFieldEdit.prototype.indexOpen=null,CustomFormFieldEdit.prototype.openFormDelay=0,CustomFormFieldEdit.prototype.$formFieldRow=null,CustomFormFieldEdit.prototype.$formRow=null,CustomFormFieldEdit.prototype.$formCont=null,CustomFormFieldEdit.prototype.$form=null,CustomFormFieldEdit.prototype.$formIcon=null,CustomFormFieldEdit.prototype.$formContHeight=null,CustomFormFieldEdit.prototype.init=function(){var a=this;a.$btn.on("click",$.proxy(a.btnClick,a))},CustomFormFieldEdit.prototype.btnClick=function(a){var b=this;return null!==b.indexOpen?(b.closeForm(),b.openFormDelay=500):b.openFormDelay=0,b.indexOpen!==parseInt(a.currentTarget.getAttribute("data-index"))&&setTimeout(function(){b.indexOpen=parseInt(a.currentTarget.getAttribute("data-index")),$.ajax({url:a.currentTarget.href,type:"get",dataType:"html"}).done(function(c){b.applyContent(a.currentTarget,c,a.currentTarget.href)}).fail(function(){console.log("error"),$.UIkit.notify({message:Rozier.messages.forbiddenPage,status:"danger",timeout:3e3,pos:"top-center"})})},b.openFormDelay),!1},CustomFormFieldEdit.prototype.applyContent=function(a,b,c){var d=this,e=['<tr class="custom-form-field-edit-form-row">','<td colspan="4">','<div class="custom-form-field-edit-form-cont">',b,"</div>","</td>","</tr>"].join("");$(a).parent().parent().after(e),setTimeout(function(){d.$formCont=$(".custom-form-field-edit-form-cont"),d.formContHeight=d.$formCont.actual("height"),d.$formRow=$(".custom-form-field-edit-form-row"),d.$form=$("#edit-custom-form-field-form"),d.$formIcon=$(d.$formFieldRow[d.indexOpen]).find(".custom-form-field-col-1 i"),d.$form.attr("action",c),d.$formIcon[0].className="uk-icon-chevron-down",d.$formCont[0].style.height="0px",d.$formCont[0].style.display="block",TweenLite.to(d.$form,.6,{height:d.formContHeight,ease:Expo.easeOut}),TweenLite.to(d.$formCont,.6,{height:d.formContHeight,ease:Expo.easeOut})},200)},CustomFormFieldEdit.prototype.closeForm=function(){var a=this;a.$formIcon[0].className="uk-icon-chevron-right",TweenLite.to(a.$formCont,.4,{height:0,ease:Expo.easeOut,onComplete:function(){a.$formRow.remove(),a.indexOpen=null}})},CustomFormFieldEdit.prototype.resize=function(){},RozierMobile=function(){var a=this;a.$menu=$("#menu-mobile"),a.$adminMenu=$("#admin-menu"),a.$adminMenuLink=a.$adminMenu.find("a"),a.$adminMenuNavParent=a.$adminMenu.find(".uk-parent"),a.$searchButton=$("#search-button"),a.$searchPanel=$("#nodes-sources-search"),a.$treeButton=$("#tree-button"),a.$treeWrapper=$("#tree-wrapper"),a.$treeWrapperLink=a.$treeWrapper.find("a"),a.$userPicture=$("#user-picture"),a.$userActions=$(".user-actions"),a.$userActionsLink=a.$userActions.find("a"),a.$mainContentOverlay=$("#main-content-overlay"),a.init()},RozierMobile.prototype.$menu=null,RozierMobile.prototype.$adminMenu=null,RozierMobile.prototype.$adminMenuNavParent=null,RozierMobile.prototype.menuOpen=!1,RozierMobile.prototype.$searchButton=null,RozierMobile.prototype.$searchPanel=null,RozierMobile.prototype.searchOpen=!1,RozierMobile.prototype.$treeButton=null,RozierMobile.prototype.$treeWrapper=null,RozierMobile.prototype.$treeWrapperLink=null,RozierMobile.prototype.treeOpen=!1,RozierMobile.prototype.$userPicture=null,RozierMobile.prototype.$userActions=null,RozierMobile.prototype.$userActionsLink=null,RozierMobile.prototype.adminOpen=!1,RozierMobile.prototype.$mainContentOverlay=null,RozierMobile.prototype.init=function(){var a=this;addClass(a.$userPicture[0],"rz-no-ajax-link"),a.$menu.on("click",$.proxy(a.menuClick,a)),a.$adminMenuLink.on("click",$.proxy(a.adminMenuLinkClick,a)),a.$adminMenuNavParent.on("click",$.proxy(a.adminMenuNavParentClick,a)),a.$searchButton.on("click",$.proxy(a.searchButtonClick,a)),a.$treeButton.on("click",$.proxy(a.treeButtonClick,a)),a.$treeWrapperLink.on("click",$.proxy(a.treeWrapperLinkClick,a)),a.$userPicture.on("click",$.proxy(a.userPictureClick,a)),a.$userActionsLink.on("click",$.proxy(a.userActionsLinkClick,a)),a.$mainContentOverlay.on("click",$.proxy(a.mainContentOverlayClick,a))},RozierMobile.prototype.menuClick=function(){var a=this;a.menuOpen?a.closeMenu():a.openMenu()},RozierMobile.prototype.adminMenuNavParentClick=function(a){var b=$(a.currentTarget).find(".uk-nav-sub");if(-1==a.currentTarget.className.indexOf("nav-open")){var c=b.find(".uk-nav-sub-item"),d=41*c.length-3;b[0].style.display="block",TweenLite.to(b,.6,{height:d,ease:Expo.easeOut,onComplete:function(){}}),addClass(a.currentTarget,"nav-open")}else TweenLite.to(b,.6,{height:0,ease:Expo.easeOut,onComplete:function(){b[0].style.display="none"}}),removeClass(a.currentTarget,"nav-open")},RozierMobile.prototype.adminMenuLinkClick=function(){var a=this;a.menuOpen&&a.closeMenu()},RozierMobile.prototype.openMenu=function(){var a=this;a.searchOpen?a.closeSearch():a.treeOpen?a.closeTree():a.userOpen&&a.closeUser(),TweenLite.to(a.$adminMenu,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),a.menuOpen=!0},RozierMobile.prototype.closeMenu=function(){var a=this,b=.8*-Rozier.windowWidth;TweenLite.to(a.$adminMenu,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),a.menuOpen=!1},RozierMobile.prototype.searchButtonClick=function(){var a=this;a.searchOpen?a.closeSearch():a.openSearch()},RozierMobile.prototype.openSearch=function(){var a=this;a.menuOpen?a.closeMenu():a.treeOpen?a.closeTree():a.userOpen&&a.closeUser(),TweenLite.to(a.$searchPanel,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),addClass(a.$searchButton[0],"active"),a.searchOpen=!0},RozierMobile.prototype.closeSearch=function(){var a=this,b=.8*-Rozier.windowWidth;TweenLite.to(a.$searchPanel,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),removeClass(a.$searchButton[0],"active"),a.searchOpen=!1},RozierMobile.prototype.treeButtonClick=function(){var a=this;a.treeOpen?a.closeTree():a.openTree()},RozierMobile.prototype.treeWrapperLinkClick=function(a){var b=this;-1==a.currentTarget.className.indexOf("tab-link")&&b.treeOpen&&b.closeTree()},RozierMobile.prototype.openTree=function(){var a=this;a.menuOpen?a.closeMenu():a.searchOpen?a.closeSearch():a.userOpen&&a.closeUser(),TweenLite.to(a.$treeWrapper,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),addClass(a.$treeButton[0],"active"),a.treeOpen=!0},RozierMobile.prototype.closeTree=function(){var a=this,b=.8*-Rozier.windowWidth;TweenLite.to(a.$treeWrapper,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),removeClass(a.$treeButton[0],"active"),a.treeOpen=!1},RozierMobile.prototype.userPictureClick=function(){var a=this;return a.userOpen?a.closeUser():a.openUser(),!1},RozierMobile.prototype.userActionsLinkClick=function(){var a=this;a.userOpen&&a.closeUser()},RozierMobile.prototype.openUser=function(){var a=this;a.menuOpen?a.closeMenu():a.searchOpen?a.closeSearch():a.treeOpen&&a.closeTree(),TweenLite.to(a.$userActions,.6,{x:0,ease:Expo.easeOut}),a.$mainContentOverlay[0].style.display="block",TweenLite.to(a.$mainContentOverlay,.6,{opacity:.5,ease:Expo.easeOut}),addClass(a.$userPicture[0],"active"),a.userOpen=!0},RozierMobile.prototype.closeUser=function(){var a=this,b=.8*Rozier.windowWidth;TweenLite.to(a.$userActions,.6,{x:b,ease:Expo.easeOut}),TweenLite.to(a.$mainContentOverlay,.6,{opacity:0,ease:Expo.easeOut,onComplete:function(){a.$mainContentOverlay[0].style.display="none"}}),removeClass(a.$userPicture[0],"active"),a.userOpen=!1},RozierMobile.prototype.mainContentOverlayClick=function(){var a=this;a.menuOpen?a.closeMenu():a.treeOpen?a.closeTree():a.userOpen&&a.closeUser()},RozierMobile.prototype.resize=function(){};var Lazyload=function(){{var a=this;$.proxy(a.onPopState,a)}a.$linksSelector=$("a:not('[target=_blank]')"),$(window).on("popstate",function(b){a.onPopState(b)}),a.$canvasLoaderContainer=$("#canvasloader-container"),a.mainColor=isset(Rozier.mainColor)?Rozier.mainColor:"#ffffff",a.initLoader()};Lazyload.prototype.$linksSelector=null,Lazyload.prototype.$textAreaHTMLeditor=null,Lazyload.prototype.$HTMLeditor=null,Lazyload.prototype.htmlEditor=[],Lazyload.prototype.$HTMLeditorContent=null,Lazyload.prototype.$HTMLeditorNav=null,Lazyload.prototype.HTMLeditorNavToRemove=null,Lazyload.prototype.documentsList=null,Lazyload.prototype.mainColor=null,Lazyload.prototype.$canvasLoaderContainer=null,Lazyload.prototype.initLoader=function(){var a=this;a.canvasLoader=new CanvasLoader("canvasloader-container"),a.canvasLoader.setColor(a.mainColor),a.canvasLoader.setShape("square"),a.canvasLoader.setDensity(90),a.canvasLoader.setRange(.8),a.canvasLoader.setSpeed(4),a.canvasLoader.setFPS(30)},Lazyload.prototype.onClick=function(a){var b=this,c=$(a.currentTarget),d=c.attr("href");return"undefined"!=typeof d&&!c.hasClass("rz-no-ajax-link")&&""!==d&&"#"!=d&&d.indexOf(Rozier.baseUrl)>=0?(history.pushState({},null,c.attr("href")),b.onPopState(null),!1):void 0},Lazyload.prototype.onPopState=function(a){var b,c=this;null!==a&&(b=a.originalEvent.state),null!==b&&"undefined"!=typeof b||(b=window.history.state),null!==b&&(c.canvasLoader.show(),c.loadContent(b,window.location))},Lazyload.prototype.loadContent=function(a,b){var c=this;$.ajax({url:b.href,type:"get",dataType:"html",data:a.headerData}).done(function(a){c.applyContent(a),c.canvasLoader.hide()}).fail(function(){console.log("error"),$.UIkit.notify({message:Rozier.messages.forbiddenPage,status:"danger",timeout:3e3,pos:"top-center"})})},Lazyload.prototype.applyContent=function(a){var b=this,c=$("#main-content-scrollable"),d=c.find(".content-global"),e=$(a);e.addClass("new-content-global"),c.append(e),e=c.find(".new-content-global"),d.fadeOut(100,function(){d.remove(),b.generalBind(),null===isMobile.any()&&Rozier.centerVerticalObjects("ajax"),e.fadeIn(200,function(){e.removeClass("new-content-global")})})},Lazyload.prototype.generalBind=function(){var a=this;new DocumentsBulk,new NodesBulk,new DocumentWidget,new NodeWidget,new CustomFormWidget,new DocumentUploader(Rozier.messages.dropzone),new ChildrenNodesField,new GeotagField,new StackNodeTree,null===isMobile.any()&&new SaveButtons,new TagAutocomplete,new FolderAutocomplete,new NodeTypeFieldsPosition,new CustomFormFieldsPosition,a.documentsList=new DocumentsList,a.settingsSaveButtons=new SettingsSaveButtons,a.nodeTypeFieldEdit=new NodeTypeFieldEdit,a.nodeEditSource=new NodeEditSource,a.customFormFieldEdit=new CustomFormFieldEdit,a.$linksSelector.off("click",$.proxy(a.onClick,a)),a.$linksSelector=$("a:not('[target=_blank]')"),a.$linksSelector.on("click",$.proxy(a.onClick,a)),a.$textAreaHTMLeditor=$("textarea[data-uk-htmleditor], textarea[data-uk-rz-htmleditor]").not("[data-uk-check-display]"),a.$textAreaHTMLeditor.length&&setTimeout(function(){for(var b=0;b<a.$textAreaHTMLeditor.length;b++)a.htmlEditor[b]=$.UIkit.htmleditor($(a.$textAreaHTMLeditor[b]),{markdown:!0,mode:"tab",labels:Rozier.messages.htmleditor}),a.$HTMLeditor=$(".uk-htmleditor"),a.$HTMLeditorNav=$(".uk-htmleditor-navbar"),a.HTMLeditorNavInner='<div class="uk-htmleditor-navbar bottom">'+a.$HTMLeditorNav[0].innerHTML+"</div>",$(a.$HTMLeditor[b]).append(a.HTMLeditorNavInner),a.htmlEditor[b].redraw();$(".uk-htmleditor-preview").css("height",250),$(".CodeMirror").css("height",250),setTimeout(function(){a.$HTMLeditorNavToRemove=$(".uk-htmleditor-navbar:not(.bottom)"),a.$HTMLeditorNavToRemove.remove(),new MarkdownEditor},0)},0),$(".colorpicker-input").length&&$(".colorpicker-input").minicolors(),$(".actions-menu").length&&null===isMobile.any()&&TweenLite.to(".actions-menu",.5,{right:0,delay:.4,ease:Expo.easeOut}),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.nodeStatuses=new NodeStatuses,$(".rz-boolean-checkbox").bootstrapSwitch(),Rozier.getMessages()},Lazyload.prototype.resize=function(){var a=this;a.$canvasLoaderContainer[0].style.left=Rozier.mainContentScrollableOffsetLeft+Rozier.mainContentScrollableWidth/2+"px"};var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var stripTags=function(a){return a.replace(/(<([^>]+)>)/gi,"")},isset=function(a){return"undefined"!=typeof a?!0:!1},addClass=function(a,b){a.classList?a.classList.add(b):a.className+=" "+b},removeClass=function(a,b){if(a.classList)a.classList.remove(b);else{a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi"),"");var c=a.className.length-1;" "==a.className[c]&&(a.className=a.className.substring(0,c))}};!function(a){a.fn.addBack=a.fn.addBack||a.fn.andSelf,a.fn.extend({actual:function(b,c){if(!this[b])throw'$.actual => The jQuery method "'+b+'" you called does not exist';var d,e,f={absolute:!1,clone:!1,includeMargin:!1},g=a.extend(f,c),h=this.eq(0);if(g.clone===!0)d=function(){var a="position: absolute !important; top: -1000 !important; ";h=h.clone().attr("style",a).appendTo("body")},e=function(){h.remove()};else{var i,j=[],k="";d=function(){i=h.parents().addBack().filter(":hidden"),k+="visibility: hidden !important; display: block !important; ",g.absolute===!0&&(k+="position: absolute !important; "),i.each(function(){var b=a(this),c=b.attr("style");j.push(c),b.attr("style",c?c+";"+k:k)})},e=function(){i.each(function(b){var c=a(this),d=j[b];void 0===d?c.removeAttr("style"):c.attr("style",d)})}}d();var l=/(outer)/.test(b)?h[b](g.includeMargin):h[b]();return e(),l}})}(jQuery),function(a){var b,c=function(a,b){"undefined"==typeof b&&(b={}),this.init(a,b)},d=c.prototype,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1])?!0:!1,i=!!document.createElement("canvas").getContext,j=!0,k=function(a,b,c){var d,a=document.createElement(a);for(d in c)a[d]=c[d];return"undefined"!=typeof b&&b.appendChild(a),a},l=function(a,b){for(var c in b)a.style[c]=b[c];return a},m=function(a,b){for(var c in b)a.setAttribute(c,b[c]);return a},n=function(a,b,c,d){a.save(),a.translate(b,c),a.rotate(d),a.translate(-b,-c),a.beginPath()};d.init=function(a,d){"boolean"==typeof d.safeVML&&(j=d.safeVML);
try{this.mum=void 0!==document.getElementById(a)?document.getElementById(a):document.body}catch(f){this.mum=document.body}if(d.id="undefined"!=typeof d.id?d.id:"canvasLoader",this.cont=k("div",this.mum,{id:d.id}),i)b=e[0],this.can=k("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=l(k("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{if(b=e[1],"undefined"==typeof c.vmlSheet){document.getElementsByTagName("head")[0].appendChild(k("style")),c.vmlSheet=document.styleSheets[document.styleSheets.length-1];var g,h=["group","oval","roundrect","fill"];for(g in h)c.vmlSheet.addRule(h[g],"behavior:url(#default#VML); position:absolute;")}this.vml=k("group",this.cont)}this.setColor(this.color),this.draw(),l(this.cont,{display:"none"})},d.cont={},d.can={},d.con={},d.cCan={},d.cCon={},d.timer={},d.activeId=0,d.diameter=40,d.setDiameter=function(a){this.diameter=Math.round(Math.abs(a)),this.redraw()},d.getDiameter=function(){return this.diameter},d.cRGB={},d.color="#000000",d.setColor=function(a){this.color=g.test(a)?a:"#000000",this.cRGB=this.getRGB(this.color),this.redraw()},d.getColor=function(){return this.color},d.shape=f[0],d.setShape=function(a){for(var b in f)if(a===f[b]){this.shape=a,this.redraw();break}},d.getShape=function(){return this.shape},d.density=40,d.setDensity=function(a){this.density=j&&b===e[1]?Math.round(Math.abs(a))<=40?Math.round(Math.abs(a)):40:Math.round(Math.abs(a)),this.density>360&&(this.density=360),this.activeId=0,this.redraw()},d.getDensity=function(){return this.density},d.range=1.3,d.setRange=function(a){this.range=Math.abs(a),this.redraw()},d.getRange=function(){return this.range},d.speed=2,d.setSpeed=function(a){this.speed=Math.round(Math.abs(a))},d.getSpeed=function(){return this.speed},d.fps=24,d.setFPS=function(a){this.fps=Math.round(Math.abs(a)),this.reset()},d.getFPS=function(){return this.fps},d.getRGB=function(a){return a="#"===a.charAt(0)?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},d.draw=function(){var a,c,d,g,i,j,o,p,q,r=0,s=this.density,t=Math.round(s*this.range),u=0;q=this.cCon;var v=this.diameter;if(b===e[0])for(q.clearRect(0,0,1e3,1e3),m(this.can,{width:v,height:v}),m(this.cCan,{width:v,height:v});s>r;){switch(p=t>=r?1-1/t*r:p=0,j=270-360/s*r,o=j/180*Math.PI,q.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+p.toString()+")",this.shape){case f[0]:case f[1]:a=.07*v,g=.47*v+Math.cos(o)*(.47*v-a)-.47*v,i=.47*v+Math.sin(o)*(.47*v-a)-.47*v,q.beginPath(),this.shape===f[1]?q.arc(.5*v+g,.5*v+i,a*p,0,2*Math.PI,!1):q.arc(.5*v+g,.5*v+i,a,0,2*Math.PI,!1);break;case f[2]:a=.12*v,g=Math.cos(o)*(.47*v-a)+.5*v,i=Math.sin(o)*(.47*v-a)+.5*v,n(q,g,i,o),q.fillRect(g,i-.5*a,a,a);break;case f[3]:case f[4]:c=.3*v,d=.27*c,g=Math.cos(o)*(d+.13*(v-d))+.5*v,i=Math.sin(o)*(d+.13*(v-d))+.5*v,n(q,g,i,o),this.shape===f[3]?q.fillRect(g,i-.5*d,c,d):(a=.55*d,q.moveTo(g+a,i-.5*d),q.lineTo(g+c-a,i-.5*d),q.quadraticCurveTo(g+c,i-.5*d,g+c,i-.5*d+a),q.lineTo(g+c,i-.5*d+d-a),q.quadraticCurveTo(g+c,i-.5*d+d,g+c-a,i-.5*d+d),q.lineTo(g+a,i-.5*d+d),q.quadraticCurveTo(g,i-.5*d+d,g,i-.5*d+d-a),q.lineTo(g,i-.5*d+a),q.quadraticCurveTo(g,i-.5*d,g+a,i-.5*d))}q.closePath(),q.fill(),q.restore(),++r}else{switch(l(this.cont,{width:v,height:v}),l(this.vml,{width:v,height:v}),this.shape){case f[0]:case f[1]:o="oval",a=140;break;case f[2]:o="roundrect",a=120;break;case f[3]:case f[4]:o="roundrect",a=300}for(c=d=a,g=500-d,i=.5*-d;s>r;){switch(p=t>=r?1-1/t*r:p=0,j=270-360/s*r,this.shape){case f[1]:c=d=a*p,g=500-.5*a-a*p*.5,i=.5*(a-a*p);break;case f[0]:case f[2]:h&&(i=0,this.shape===f[2]&&(g=500-.5*d));break;case f[3]:case f[4]:c=.95*a,d=.28*c,h?(g=0,i=500-.5*d):(g=500-c,i=.5*-d),u=this.shape===f[4]?.6:0}q=m(l(k("group",this.vml),{width:1e3,height:1e3,rotation:j}),{coordsize:"1000,1000",coordorigin:"-500,-500"}),q=l(k(o,q,{stroked:!1,arcSize:u}),{width:c,height:d,top:i,left:g}),k("fill",q,{color:this.color,opacity:p}),++r}}this.tick(!0)},d.clean=function(){if(b===e[0])this.con.clearRect(0,0,1e3,1e3);else{var a=this.vml;if(a.hasChildNodes())for(;a.childNodes.length>=1;)a.removeChild(a.firstChild)}},d.redraw=function(){this.clean(),this.draw()},d.reset=function(){"number"==typeof this.timer&&(this.hide(),this.show())},d.tick=function(a){var c=this.con,d=this.diameter;a||(this.activeId+=360/this.density*this.speed),b===e[0]?(c.clearRect(0,0,d,d),n(c,.5*d,.5*d,this.activeId/180*Math.PI),c.drawImage(this.cCan,0,0,d,d),c.restore()):(this.activeId>=360&&(this.activeId-=360),l(this.vml,{rotation:this.activeId}))},d.show=function(){if("number"!=typeof this.timer){var a=this;this.timer=self.setInterval(function(){a.tick()},Math.round(1e3/this.fps)),l(this.cont,{display:"block"})}},d.hide=function(){"number"==typeof this.timer&&(clearInterval(this.timer),delete this.timer,l(this.cont,{display:"none"}))},d.kill=function(){var a=this.cont;"number"==typeof this.timer&&this.hide(),b===e[0]?(a.removeChild(this.can),a.removeChild(this.cCan)):a.removeChild(this.vml);for(var c in this)delete this[c]},a.CanvasLoader=c}(window),PointerEventsPolyfill.initialize=function(a){return null==PointerEventsPolyfill.singleton&&(PointerEventsPolyfill.singleton=new PointerEventsPolyfill(a)),PointerEventsPolyfill.singleton},PointerEventsPolyfill.prototype.register_mouse_events=function(){$(document).on(this.options.mouseEvents.join(" "),this.options.selector,function(a){if("none"==$(this).css("pointer-events")){var b=$(this).css("display");$(this).css("display","none");var c=document.elementFromPoint(a.clientX,a.clientY);return b?$(this).css("display",b):$(this).css("display",""),a.target=c,$(c).trigger(a),!1}return!0})};var Rozier={};Rozier.$window=null,Rozier.$body=null,Rozier.windowWidth=null,Rozier.windowHeight=null,Rozier.resizeFirst=!0,Rozier.gMapLoaded=!1,Rozier.searchNodesSourcesDelay=null,Rozier.nodeTrees=[],Rozier.treeTrees=[],Rozier.$userPanelContainer=null,Rozier.$minifyTreePanelButton=null,Rozier.$mainTrees=null,Rozier.$mainTreesContainer=null,Rozier.$mainTreeElementName=null,Rozier.$treeContextualButton=null,Rozier.$nodesSourcesSearch=null,Rozier.nodesSourcesSearchHeight=null,Rozier.$nodeTreeHead=null,Rozier.nodeTreeHeadHeight=null,Rozier.$treeScrollCont=null,Rozier.$treeScroll=null,Rozier.treeScrollHeight=null,Rozier.$mainContentScrollable=null,Rozier.mainContentScrollableWidth=null,Rozier.mainContentScrollableOffsetLeft=null,Rozier.$backTopBtn=null,Rozier.onDocumentReady=function(){for(var a in temp)Rozier[a]=temp[a];Rozier.lazyload=new Lazyload,Rozier.$window=$(window),Rozier.$body=$("body"),null===isMobile.any()&&Rozier.centerVerticalObjects(),Rozier.$userPanelContainer=$("#user-panel-container"),Rozier.$minifyTreePanelButton=$("#minify-tree-panel-button"),Rozier.$mainTrees=$("#main-trees"),Rozier.$mainTreesContainer=$("#main-trees-container"),Rozier.$nodesSourcesSearch=$("#nodes-sources-search"),Rozier.$mainContentScrollable=$("#main-content-scrollable"),Rozier.$backTopBtn=$("#back-top-button"),Modernizr.testProp("pointerEvents")||PointerEventsPolyfill.initialize({selector:"#main-trees-overlay"}),$("#nodes-sources-search-input").on("focus",function(){$("#nodes-sources-search").addClass("focus-on"),$("#nodes-sources-search-results").fadeIn(),setTimeout(function(){Rozier.resize()},500)}),$("#nodes-sources-search-input").on("focusout",function(){$("#nodes-sources-search-results").fadeOut(),$("#nodes-sources-search").removeClass("focus-on"),$(this).val(""),setTimeout(function(){Rozier.resize()},500)}),$("#nodes-sources-search-input").on("keyup",Rozier.onSearchNodesSources),Rozier.$minifyTreePanelButton.on("click",Rozier.toggleTreesPanel),Rozier.$backTopBtn.on("click",$.proxy(Rozier.backTopBtnClick,Rozier)),Rozier.lazyload.generalBind(),Rozier.bindMainNodeTreeLangs(),Rozier.$window.on("resize",$.proxy(Rozier.resize,Rozier)),Rozier.$window.trigger("resize")},Rozier.initNestables=function(){$(".uk-nestable").each(function(a,b){$.UIkit.nestable(b)})},Rozier.bindMainTrees=function(){var a=this;$(".nodetree-widget .root-tree").off("uk.nestable.change"),$(".nodetree-widget .root-tree").on("uk.nestable.change",Rozier.onNestableNodeTreeChange),$(".tagtree-widget .root-tree").off("uk.nestable.change"),$(".tagtree-widget .root-tree").on("uk.nestable.change",Rozier.onNestableTagTreeChange),$(".foldertree-widget .root-tree").off("uk.nestable.change"),$(".foldertree-widget .root-tree").on("uk.nestable.change",Rozier.onNestableFolderTreeChange),a.$mainTreeElementName=a.$mainTrees.find(".tree-element-name"),a.$mainTreeElementName.off("contextmenu",$.proxy(a.maintreeElementNameRightClick,a)),a.$mainTreeElementName.on("contextmenu",$.proxy(a.maintreeElementNameRightClick,a))},Rozier.maintreeElementNameRightClick=function(a){var b=$(a.currentTarget).parent().find(".tree-contextualmenu");return-1==b[0].className.indexOf("uk-open")?addClass(b[0],"uk-open"):removeClass(b[0],"uk-open"),!1},Rozier.bindMainNodeTreeLangs=function(){$("body").on("click","#tree-container .nodetree-langs a",function(a){var b=$(a.currentTarget),c=parseInt(b.attr("data-translation-id"));Rozier.refreshMainNodeTree(c)})},Rozier.getMessages=function(){$.ajax({url:Rozier.routes.ajaxSessionMessages,type:"GET",dataType:"json",data:{_action:"messages",_token:Rozier.ajaxToken}}).done(function(a){if("undefined"!=typeof a.messages){if("undefined"!=typeof a.messages.confirm&&a.messages.confirm.length>0)for(var b=a.messages.confirm.length-1;b>=0;b--)$.UIkit.notify({message:a.messages.confirm[b],status:"success",timeout:2e3,pos:"top-center"});if("undefined"!=typeof a.messages.error&&a.messages.error.length>0)for(var c=a.messages.error.length-1;c>=0;c--)$.UIkit.notify({message:a.messages.error[c],status:"error",timeout:2e3,pos:"top-center"})}}).fail(function(){console.log("[Rozier.getMessages] error")})},Rozier.refreshMainNodeTree=function(a){var b=$("#tree-container").find(".nodetree-widget");if(b.length){var c={_token:Rozier.ajaxToken,_action:"requestMainNodeTree"},d=Rozier.routes.nodesTreeAjax;isset(a)&&a>0&&(d+="/"+a),$.ajax({url:d,type:"post",dataType:"json",data:c}).done(function(a){b.length&&"undefined"!=typeof a.nodeTree&&b.fadeOut("slow",function(){b.replaceWith(a.nodeTree),b=$("#tree-container").find(".nodetree-widget"),b.fadeIn(),Rozier.initNestables(),Rozier.bindMainTrees(),Rozier.resize(),Rozier.lazyload.generalBind()})}).fail(function(a){console.log(a.responseJSON)})}else console.error("No main node-tree available.")},Rozier.centerVerticalObjects=function(a){for(var b=$(".rz-vertical-align"),c=0;c<b.length;c++)b[c].style.top="50%",b[c].style.marginTop=$(b[c]).actual("outerHeight")/-2+"px",b[c].className.indexOf("actions-menu")>=0&&"ajax"==a&&(b[c].style.right=-$(b[c]).actual("outerWidth")+"px")},Rozier.toggleTreesPanel=function(){return $("#main-trees").toggleClass("minified"),$("#minify-tree-panel-button i").toggleClass("uk-icon-rz-panel-tree-open"),$("#minify-tree-panel-area").toggleClass("tree-panel-hidden"),!1},Rozier.toggleUserPanel=function(){return $("#user-panel").toggleClass("minified"),!1},Rozier.onSearchNodesSources=function(a){var b=$(a.currentTarget);b.val().length>2&&(clearTimeout(Rozier.searchNodesSourcesDelay),Rozier.searchNodesSourcesDelay=setTimeout(function(){var a={_token:Rozier.ajaxToken,_action:"searchNodesSources",searchTerms:b.val()};console.log(a),$.ajax({url:Rozier.routes.searchNodesSourcesAjax,type:"POST",dataType:"json",data:a}).done(function(a){if(console.log(a),"undefined"!=typeof a.data&&a.data.length>0){$results=$("#nodes-sources-search-results"),$results.empty();for(var b in a.data)$results.append('<li><a href="'+a.data[b].url+'" style="border-left-color:'+a.data[b].typeColor+'"><span class="title">'+a.data[b].title+'</span> <span class="type">'+a.data[b].typeName+"</span></a></li>");$results.append('<a id="see-all" href="#">'+Rozier.messages.see_all+"</a>")}}).fail(function(a){console.log(a)})},300))},Rozier.onNestableNodeTreeChange=function(a,b,c){if(console.log("Node: "+b.data("node-id")+" status : "+c),"removed"==c)return!1;var d=parseInt(b.data("node-id")),e=parseInt(b.parents("ul").first().data("parent-node-id"));if(console.log(e),d===e)return console.log("You cannot move a node inside itself!"),alert("You cannot move a node inside itself!"),window.location.reload(),!1;var f={_token:Rozier.ajaxToken,_action:"updatePosition",nodeId:d};b.next().length?f.nextNodeId=parseInt(b.next().data("node-id")):b.prev().length&&(f.prevNodeId=parseInt(b.prev().data("node-id"))),isNaN(e)&&(e=null),f.newParent=e,console.log(f),$.ajax({url:Rozier.routes.nodeAjaxEdit.replace("%nodeId%",d),type:"POST",dataType:"json",data:f}).done(function(a){console.log(a),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)})},Rozier.onNestableTagTreeChange=function(a,b,c){if(console.log("Tag: "+b.data("tag-id")+" status : "+c),"removed"==c)return!1;var d=parseInt(b.data("tag-id")),e=parseInt(b.parents("ul").first().data("parent-tag-id"));if(d===e)return console.log("You cannot move a tag inside itself!"),alert("You cannot move a tag inside itself!"),window.location.reload(),!1;var f={_token:Rozier.ajaxToken,_action:"updatePosition",tagId:d};b.next().length?f.nextTagId=parseInt(b.next().data("tag-id")):b.prev().length&&(f.prevTagId=parseInt(b.prev().data("tag-id"))),isNaN(e)&&(e=null),f.newParent=e,console.log(f),$.ajax({url:Rozier.routes.tagAjaxEdit.replace("%tagId%",d),type:"POST",dataType:"json",data:f}).done(function(a){console.log(a),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)})},Rozier.onNestableFolderTreeChange=function(a,b,c){if(console.log("Folder: "+b.data("folder-id")+" status : "+c),"removed"==c)return!1;var d=parseInt(b.data("folder-id")),e=parseInt(b.parents("ul").first().data("parent-folder-id"));if(d===e)return console.log("You cannot move a folder inside itself!"),alert("You cannot move a folder inside itself!"),window.location.reload(),!1;var f={_token:Rozier.ajaxToken,_action:"updatePosition",folderId:d};b.next().length?f.nextFolderId=parseInt(b.next().data("folder-id")):b.prev().length&&(f.prevFolderId=parseInt(b.prev().data("folder-id"))),isNaN(e)&&(e=null),f.newParent=e,console.log(f),$.ajax({url:Rozier.routes.folderAjaxEdit.replace("%folderId%",d),type:"POST",dataType:"json",data:f}).done(function(a){console.log(a),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)})},Rozier.backTopBtnClick=function(){var a=this;return TweenLite.to(a.$mainContentScrollable,.6,{scrollTo:{y:0},ease:Expo.easeOut}),!1},Rozier.resize=function(){var a=this;a.windowWidth=a.$window.width(),a.windowHeight=a.$window.height(),a.windowWidth>768&&a.windowWidth<=1200&&a.resizeFirst&&(a.$mainTrees[0].style.display="none",a.$minifyTreePanelButton.trigger("click"),setTimeout(function(){a.$mainTrees[0].style.display="table-cell"},1e3)),a.windowWidth<=768&&a.resizeFirst&&(a.mobile=new RozierMobile),null===isMobile.any()&&(a.$userPanelContainer[0].style.height=a.windowHeight+"px",a.$mainTreesContainer[0].style.height=a.windowHeight+"px"),a.$mainContentScrollable[0].style.height=a.windowHeight+"px",a.$nodeTreeHead=a.$mainTrees.find(".nodetree-head"),a.$treeScrollCont=a.$mainTrees.find(".tree-scroll-cont"),a.$treeScroll=a.$mainTrees.find(".tree-scroll"),a.nodesSourcesSearchHeight=a.$nodesSourcesSearch.height(),a.nodeTreeHeadHeight=a.$nodeTreeHead.height(),a.treeScrollHeight=a.windowHeight-(a.nodesSourcesSearchHeight+a.nodeTreeHeadHeight),null!==isMobile.any()&&(a.treeScrollHeight=a.windowHeight-(100+a.nodeTreeHeadHeight));for(var b=0;b<a.$treeScrollCont.length;b++)a.$treeScrollCont[b].style.height=a.treeScrollHeight+"px";a.mainContentScrollableWidth=a.$mainContentScrollable.width(),a.mainContentScrollableOffsetLeft=a.windowWidth-a.mainContentScrollableWidth,a.lazyload.resize(),null===a.lazyload||a.resizeFirst||a.lazyload.documentsList.resize(),a.resizeFirst&&(a.resizeFirst=!1)},$(document).ready(Rozier.onDocumentReady);