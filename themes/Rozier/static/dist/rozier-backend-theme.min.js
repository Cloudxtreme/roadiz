/*! rozier-backend-theme 2014-09-02 16:48:06 */
var DocumentWidget=function(){var a=this;a.widgets=$("[data-document-widget]"),a.toggleExplorerButtons=$("[data-document-widget-toggle-explorer]"),a.unlinkDocumentButtons=$("[data-document-widget-unlink-document]"),a.init()};DocumentWidget.prototype.explorer=null,DocumentWidget.prototype.widgets=null,DocumentWidget.prototype.toggleExplorerButtons=null,DocumentWidget.prototype.unlinkDocumentButtons=null,DocumentWidget.prototype.init=function(){var a=this;$(".documents-widget-nestable").on("nestable-change",$.proxy(a.onNestableDocumentWidgetChange,a)),a.toggleExplorerButtons.on("click",$.proxy(a.onExplorerToggle,a)),a.unlinkDocumentButtons.on("click",$.proxy(a.onUnlinkDocument,a))},DocumentWidget.prototype.onNestableDocumentWidgetChange=function(a,b){console.log("Document: "+b.data("document-id"));var c=b.parent(),d="source["+c.data("input-name")+"]";c.find("li").each(function(a){$(this).find("input").attr("name",d+"["+a+"]")})},DocumentWidget.prototype.onExplorerToggle=function(){var a=this;return null===a.explorer?(a.toggleExplorerButtons.addClass("uk-active"),$.ajax({url:Rozier.routes.documentsAjaxExplorer,type:"GET",dataType:"json",data:{_action:"toggleExplorer",_token:Rozier.ajaxToken}}).done(function(b){console.log(b),a.createExplorer(b),console.log("success")}).fail(function(a){console.log(a),console.log("error")}).always(function(){console.log("complete")})):(a.toggleExplorerButtons.removeClass("uk-active"),a.explorer.remove(),a.explorer=null),!1},DocumentWidget.prototype.onUnlinkDocument=function(a){var b=$(a.currentTarget);return b.parent("li").remove(),b.parents().find(".documents-widget-nestable").first().trigger("nestable-change"),!1},DocumentWidget.prototype.createExplorer=function(a){var b=this;$("body").append('<div class="document-widget-explorer"><ul class="uk-nestable" data-uk-nestable="{group:\'documents-widget\',maxDepth:1}"></ul></div>'),b.explorer=$(".document-widget-explorer");for(var c=0;c<a.documents.length;c++){var d=a.documents[c];b.explorer.find("ul").append(d.html)}},function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var Rozier={};Rozier.searchNodesSourcesDelay=null,Rozier.onDocumentReady=function(){for(var a in temp)Rozier[a]=temp[a];new DocumentWidget,$(".nodetree-widget .root-tree").on("nestable-change",Rozier.onNestableNodeTreeChange),$(".tagtree-widget .root-tree").on("nestable-change",Rozier.onNestableTagTreeChange),$("#nodes-sources-search-input").on("keyup",Rozier.onSearchNodesSources),$("[data-uk-pagination]").on("uk-select-page",function(a,b){document.location.href=document.location.origin+document.location.pathname+"?page="+(b+1)})},Rozier.onSearchNodesSources=function(a){var b=$(a.currentTarget);b.val().length>2&&(clearTimeout(Rozier.searchNodesSourcesDelay),Rozier.searchNodesSourcesDelay=setTimeout(function(){var a={_token:Rozier.ajaxToken,_action:"searchNodesSources",searchTerms:b.val()};console.log(a),$.ajax({url:Rozier.routes.searchNodesSourcesAjax,type:"POST",dataType:"json",data:a}).done(function(a){if(console.log(a),"undefined"!=typeof a.data&&a.data.length>0){$results=$("#nodes-sources-search-results"),$results.empty();for(var b in a.data)$results.append('<li><a href="'+a.data[b].url+'"><span class="title">'+a.data[b].title+'</span> <span class="type">'+a.data[b].typeName+"</span></a></li>")}}).fail(function(a){console.log(a)}).always(function(){console.log("complete")})},300))},Rozier.onNestableNodeTreeChange=function(a,b,c){if(console.log("Node: "+b.data("node-id")+" status : "+c),"removed"==c)return!1;var d=parseInt(b.data("node-id")),e=parseInt(b.parents("ul").first().data("parent-node-id"));if(d===e)return console.log("You cannot move a node inside itself!"),alert("You cannot move a node inside itself!"),window.location.reload(),!1;var f={_token:Rozier.ajaxToken,_action:"updatePosition",nodeId:d};b.next().length?f.nextNodeId=parseInt(b.next().data("node-id")):b.prev().length&&(f.prevNodeId=parseInt(b.prev().data("node-id"))),isNaN(e)&&(e=null),f.newParent=e,console.log(f),$.ajax({url:Rozier.routes.nodeAjaxEdit.replace("%nodeId%",d),type:"POST",dataType:"json",data:f}).done(function(a){console.log(a),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)}).always(function(){console.log("complete")})},Rozier.onNestableTagTreeChange=function(a,b,c){if(console.log("Tag: "+b.data("tag-id")+" status : "+c),"removed"==c)return!1;var d=parseInt(b.data("tag-id")),e=parseInt(b.parents("ul").first().data("parent-tag-id"));if(d===e)return console.log("You cannot move a tag inside itself!"),alert("You cannot move a tag inside itself!"),window.location.reload(),!1;var f={_token:Rozier.ajaxToken,_action:"updatePosition",tagId:d};b.next().length?f.nextTagId=parseInt(b.next().data("tag-id")):b.prev().length&&(f.prevTagId=parseInt(b.prev().data("tag-id"))),isNaN(e)&&(e=null),f.newParent=e,console.log(f),$.ajax({url:Rozier.routes.tagAjaxEdit.replace("%tagId%",d),type:"POST",dataType:"json",data:f}).done(function(a){console.log(a),$.UIkit.notify({message:a.responseText,status:a.status,timeout:3e3,pos:"top-center"})}).fail(function(a){console.log(a)}).always(function(){console.log("complete")})},$(document).ready(Rozier.onDocumentReady);